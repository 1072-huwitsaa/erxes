{"ast":null,"code":"import _defineProperty from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/leads/components/Lead.tsx\";\nimport Button from \"erxes-common-ui/lib/components/button\";\nimport FormControl from \"modules/common/components/form/Control\";\nimport ConditionsRule from \"modules/common/components/rule/ConditionsRule\";\nimport { Step, Steps } from \"modules/common/components/step\";\nimport { StepWrapper, TitleContainer } from \"modules/common/components/step/styles\";\nimport { Alert } from \"modules/common/utils\";\nimport { __ } from \"modules/common/utils\";\nimport Wrapper from \"modules/layout/components/Wrapper\";\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { SmallLoader } from \"modules/common/components/ButtonMutate\";\nimport { CallOut, ChooseType, FormStep, FullPreviewStep, OptionStep, SuccessStep } from \"./step\";\n\nvar Lead =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Lead, _React$Component);\n\n  function Lead(props) {\n    var _this;\n\n    _classCallCheck(this, Lead);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Lead).call(this, props));\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n      var _this$state = _this.state,\n          brand = _this$state.brand,\n          calloutTitle = _this$state.calloutTitle,\n          title = _this$state.title,\n          rules = _this$state.rules,\n          formData = _this$state.formData;\n\n      if (!title) {\n        return Alert.error(\"Write title\");\n      }\n\n      if (!formData.title) {\n        return Alert.error(\"Write Form title\");\n      }\n\n      if (!brand) {\n        return Alert.error(\"Choose a brand\");\n      }\n\n      var doc = {\n        name: title,\n        brandId: brand,\n        languageCode: _this.state.language,\n        leadData: {\n          loadType: _this.state.type,\n          successAction: _this.state.successAction,\n          fromEmail: _this.state.fromEmail,\n          userEmailTitle: _this.state.userEmailTitle,\n          userEmailContent: _this.state.userEmailContent,\n          adminEmails: _this.state.adminEmails,\n          adminEmailTitle: _this.state.adminEmailTitle,\n          adminEmailContent: _this.state.adminEmailContent,\n          thankContent: _this.state.thankContent,\n          redirectUrl: _this.state.redirectUrl,\n          themeColor: _this.state.theme || _this.state.color,\n          callout: {\n            title: calloutTitle,\n            body: _this.state.bodyValue,\n            buttonText: _this.state.calloutBtnText,\n            featuredImage: _this.state.logoPreviewUrl,\n            skip: _this.state.isSkip\n          },\n          rules: (rules || []).filter(function (rule) {\n            return rule.condition && rule.value;\n          }),\n          isRequireOnce: _this.state.isRequireOnce\n        }\n      };\n\n      _this.props.save(doc);\n    };\n\n    _this.renderSaveButton = function () {\n      var isActionLoading = _this.props.isActionLoading;\n      var cancelButton = React.createElement(Link, {\n        to: \"/leads\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, React.createElement(Button, {\n        btnStyle: \"simple\",\n        icon: \"times-circle\",\n        uppercase: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, \"Cancel\"));\n      return React.createElement(Button.Group, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, cancelButton, React.createElement(Button, {\n        disabled: isActionLoading,\n        btnStyle: \"success\",\n        uppercase: false,\n        icon: isActionLoading ? undefined : \"check-circle\",\n        onClick: _this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, isActionLoading && React.createElement(SmallLoader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }), \"Save\"));\n    };\n\n    _this.onChange = function (key, value) {\n      _this.setState(_defineProperty({}, key, value));\n    };\n\n    _this.onFormDocChange = function (formData) {\n      _this.setState({\n        formData: formData\n      });\n    };\n\n    _this.onFormInit = function (fields) {\n      var formData = _this.state.formData;\n      formData.fields = fields;\n\n      _this.setState({\n        formData: formData\n      });\n    };\n\n    var integration = props.integration || {};\n    var _integration$leadData = integration.leadData,\n        leadData = _integration$leadData === void 0 ? {} : _integration$leadData;\n    var callout = leadData.callout || {};\n    var form = integration.form || {};\n    _this.state = {\n      activeStep: 1,\n      type: leadData.loadType || \"shoutbox\",\n      successAction: leadData.successAction || \"\",\n      fromEmail: leadData.fromEmail || \"\",\n      userEmailTitle: leadData.userEmailTitle || \"\",\n      userEmailContent: leadData.userEmailContent || \"\",\n      adminEmails: leadData.adminEmails || [],\n      adminEmailTitle: leadData.adminEmailTitle || \"\",\n      adminEmailContent: leadData.adminEmailContent || \"\",\n      thankContent: leadData.thankContent || \"Thank you.\",\n      redirectUrl: leadData.redirectUrl || \"\",\n      rules: leadData.rules || [],\n      brand: integration.brandId,\n      language: integration.languageCode,\n      title: integration.name,\n      calloutTitle: callout.title || \"Title\",\n      bodyValue: callout.body || \"\",\n      calloutBtnText: callout.buttonText || \"Start\",\n      color: \"\",\n      logoPreviewStyle: {},\n      defaultValue: {},\n      logo: \"\",\n      formData: {\n        title: form.title || \"\",\n        desc: form.description || \"\",\n        btnText: form.buttonText || \"Send\",\n        fields: [],\n        type: form.type || \"\"\n      },\n      theme: leadData.themeColor || \"#6569DF\",\n      isRequireOnce: leadData.isRequireOnce,\n      logoPreviewUrl: callout.featuredImage,\n      isSkip: callout.skip && true\n    };\n    return _this;\n  }\n\n  _createClass(Lead, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          activeStep = _this$state2.activeStep,\n          calloutTitle = _this$state2.calloutTitle,\n          type = _this$state2.type,\n          calloutBtnText = _this$state2.calloutBtnText,\n          bodyValue = _this$state2.bodyValue,\n          color = _this$state2.color,\n          theme = _this$state2.theme,\n          logoPreviewUrl = _this$state2.logoPreviewUrl,\n          thankContent = _this$state2.thankContent,\n          carousel = _this$state2.carousel,\n          language = _this$state2.language,\n          title = _this$state2.title,\n          successAction = _this$state2.successAction,\n          isSkip = _this$state2.isSkip,\n          rules = _this$state2.rules,\n          formData = _this$state2.formData,\n          isRequireOnce = _this$state2.isRequireOnce;\n      var integration = this.props.integration;\n      var leadData = integration && integration.leadData;\n      var brand = integration && integration.brand;\n      var breadcrumb = [{\n        title: __(\"Pop Ups\"),\n        link: \"/leads\"\n      }];\n      var constant = isSkip ? \"form\" : \"callout\";\n\n      var onChange = function onChange(e) {\n        return _this2.onChange(\"title\", e.currentTarget.value);\n      };\n\n      return React.createElement(React.Fragment, null, React.createElement(Wrapper.Header, {\n        title: __(\"Leads\"),\n        breadcrumb: breadcrumb,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }), React.createElement(StepWrapper, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, React.createElement(TitleContainer, {\n        id: \"CreatePopupsTitle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, __(\"Title\")), React.createElement(FormControl, {\n        required: true,\n        onChange: onChange,\n        defaultValue: title,\n        autoFocus: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }), this.renderSaveButton()), React.createElement(Steps, {\n        active: activeStep || 1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      }, React.createElement(Step, {\n        img: \"/images/icons/erxes-04.svg\",\n        title: \"Type\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }, React.createElement(ChooseType, {\n        onChange: this.onChange,\n        type: type,\n        calloutTitle: calloutTitle,\n        calloutBtnText: calloutBtnText,\n        color: color,\n        theme: theme,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-03.svg\",\n        title: \"CallOut\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, React.createElement(CallOut, {\n        onChange: this.onChange,\n        type: type,\n        calloutTitle: calloutTitle,\n        calloutBtnText: calloutBtnText,\n        bodyValue: bodyValue,\n        color: color,\n        theme: theme,\n        image: logoPreviewUrl,\n        skip: isSkip,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-12.svg\",\n        title: \"Form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, React.createElement(FormStep, {\n        type: type,\n        color: color,\n        theme: theme,\n        formId: integration && integration.formId,\n        formData: formData,\n        afterDbSave: this.props.afterFormDbSave,\n        onDocChange: this.onFormDocChange,\n        onInit: this.onFormInit,\n        isReadyToSaveForm: this.props.isReadyToSaveForm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-02.svg\",\n        title: \"Rule\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, React.createElement(ConditionsRule, {\n        rules: rules || [],\n        onChange: this.onChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-06.svg\",\n        title: \"Options\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, React.createElement(OptionStep, {\n        onChange: this.onChange,\n        type: type,\n        color: color,\n        brand: brand,\n        theme: theme,\n        isRequireOnce: isRequireOnce,\n        language: language,\n        formData: formData,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-13.svg\",\n        title: \"Thank content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313\n        },\n        __self: this\n      }, React.createElement(SuccessStep, {\n        onChange: this.onChange,\n        thankContent: thankContent,\n        type: type,\n        color: color,\n        theme: theme,\n        successAction: successAction,\n        leadData: leadData,\n        formId: integration && integration.formId,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      })), React.createElement(Step, {\n        img: \"/images/icons/erxes-19.svg\",\n        title: \"Full Preview\",\n        noButton: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325\n        },\n        __self: this\n      }, React.createElement(FullPreviewStep, {\n        onChange: this.onChange,\n        calloutTitle: calloutTitle,\n        calloutBtnText: calloutBtnText,\n        bodyValue: bodyValue,\n        type: type,\n        color: color,\n        theme: theme,\n        image: logoPreviewUrl,\n        thankContent: thankContent,\n        skip: isSkip,\n        carousel: carousel || constant,\n        formData: formData,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return Lead;\n}(React.Component);\n\nexport default Lead;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/leads/components/Lead.tsx"],"names":["Button","FormControl","ConditionsRule","Step","Steps","StepWrapper","TitleContainer","Alert","__","Wrapper","React","Link","SmallLoader","CallOut","ChooseType","FormStep","FullPreviewStep","OptionStep","SuccessStep","Lead","props","handleSubmit","e","preventDefault","state","brand","calloutTitle","title","rules","formData","error","doc","name","brandId","languageCode","language","leadData","loadType","type","successAction","fromEmail","userEmailTitle","userEmailContent","adminEmails","adminEmailTitle","adminEmailContent","thankContent","redirectUrl","themeColor","theme","color","callout","body","bodyValue","buttonText","calloutBtnText","featuredImage","logoPreviewUrl","skip","isSkip","filter","rule","condition","value","isRequireOnce","save","renderSaveButton","isActionLoading","cancelButton","undefined","onChange","key","setState","onFormDocChange","onFormInit","fields","integration","form","activeStep","logoPreviewStyle","defaultValue","logo","desc","description","btnText","carousel","breadcrumb","link","constant","currentTarget","formId","afterFormDbSave","isReadyToSaveForm","Component"],"mappings":"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","sourcesContent":["import Button from \"erxes-common-ui/lib/components/button\";\nimport FormControl from \"modules/common/components/form/Control\";\nimport ConditionsRule from \"modules/common/components/rule/ConditionsRule\";\nimport { Step, Steps } from \"modules/common/components/step\";\nimport {\n  StepWrapper,\n  TitleContainer,\n} from \"modules/common/components/step/styles\";\nimport { IConditionsRule } from \"modules/common/types\";\nimport { Alert } from \"modules/common/utils\";\nimport { __ } from \"modules/common/utils\";\nimport Wrapper from \"modules/layout/components/Wrapper\";\nimport { ILeadData, ILeadIntegration } from \"../types\";\n\nimport React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { SmallLoader } from \"modules/common/components/ButtonMutate\";\nimport { IFormData } from \"modules/forms/types\";\nimport { IField } from \"modules/settings/properties/types\";\nimport {\n  CallOut,\n  ChooseType,\n  FormStep,\n  FullPreviewStep,\n  OptionStep,\n  SuccessStep,\n} from \"./step\";\n\ntype Props = {\n  integration?: ILeadIntegration;\n  loading?: boolean;\n  isActionLoading: boolean;\n  isReadyToSaveForm: boolean;\n  afterFormDbSave: (formId: string) => void;\n  save: (params: {\n    name: string;\n    brandId: string;\n    languageCode?: string;\n    leadData: ILeadData;\n  }) => void;\n};\n\ntype State = {\n  activeStep?: number;\n  type: string;\n  brand?: string;\n  language?: string;\n  title?: string;\n  calloutTitle?: string;\n  bodyValue?: string;\n  calloutBtnText?: string;\n  theme: string;\n  isRequireOnce?: boolean;\n  logoPreviewUrl?: string;\n  isSkip?: boolean;\n  color: string;\n  logoPreviewStyle?: { opacity?: string };\n  defaultValue: { [key: string]: boolean };\n  logo?: string;\n  rules?: IConditionsRule[];\n  formData: IFormData;\n\n  successAction?: string;\n  fromEmail?: string;\n  userEmailTitle?: string;\n  userEmailContent?: string;\n  adminEmails?: string[];\n  adminEmailTitle?: string;\n  adminEmailContent?: string;\n  thankContent?: string;\n  redirectUrl?: string;\n  carousel?: string;\n};\n\nclass Lead extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const integration = props.integration || ({} as ILeadIntegration);\n\n    const { leadData = {} as ILeadData } = integration;\n    const callout = leadData.callout || {};\n    const form = integration.form || {};\n\n    this.state = {\n      activeStep: 1,\n\n      type: leadData.loadType || \"shoutbox\",\n      successAction: leadData.successAction || \"\",\n      fromEmail: leadData.fromEmail || \"\",\n      userEmailTitle: leadData.userEmailTitle || \"\",\n      userEmailContent: leadData.userEmailContent || \"\",\n      adminEmails: leadData.adminEmails || [],\n      adminEmailTitle: leadData.adminEmailTitle || \"\",\n      adminEmailContent: leadData.adminEmailContent || \"\",\n      thankContent: leadData.thankContent || \"Thank you.\",\n      redirectUrl: leadData.redirectUrl || \"\",\n      rules: leadData.rules || [],\n\n      brand: integration.brandId,\n      language: integration.languageCode,\n      title: integration.name,\n      calloutTitle: callout.title || \"Title\",\n      bodyValue: callout.body || \"\",\n      calloutBtnText: callout.buttonText || \"Start\",\n      color: \"\",\n      logoPreviewStyle: {},\n      defaultValue: {},\n      logo: \"\",\n      formData: {\n        title: form.title || \"\",\n        desc: form.description || \"\",\n        btnText: form.buttonText || \"Send\",\n        fields: [],\n        type: form.type || \"\",\n      },\n      theme: leadData.themeColor || \"#6569DF\",\n      isRequireOnce: leadData.isRequireOnce,\n      logoPreviewUrl: callout.featuredImage,\n      isSkip: callout.skip && true,\n    };\n  }\n\n  handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const { brand, calloutTitle, title, rules, formData } = this.state;\n\n    if (!title) {\n      return Alert.error(\"Write title\");\n    }\n\n    if (!formData.title) {\n      return Alert.error(\"Write Form title\");\n    }\n\n    if (!brand) {\n      return Alert.error(\"Choose a brand\");\n    }\n\n    const doc = {\n      name: title,\n      brandId: brand,\n      languageCode: this.state.language,\n      leadData: {\n        loadType: this.state.type,\n        successAction: this.state.successAction,\n        fromEmail: this.state.fromEmail,\n        userEmailTitle: this.state.userEmailTitle,\n        userEmailContent: this.state.userEmailContent,\n        adminEmails: this.state.adminEmails,\n        adminEmailTitle: this.state.adminEmailTitle,\n        adminEmailContent: this.state.adminEmailContent,\n        thankContent: this.state.thankContent,\n        redirectUrl: this.state.redirectUrl,\n        themeColor: this.state.theme || this.state.color,\n        callout: {\n          title: calloutTitle,\n          body: this.state.bodyValue,\n          buttonText: this.state.calloutBtnText,\n          featuredImage: this.state.logoPreviewUrl,\n          skip: this.state.isSkip,\n        },\n        rules: (rules || []).filter((rule) => rule.condition && rule.value),\n        isRequireOnce: this.state.isRequireOnce,\n      },\n    };\n\n    this.props.save(doc);\n  };\n\n  renderSaveButton = () => {\n    const { isActionLoading } = this.props;\n\n    const cancelButton = (\n      <Link to=\"/leads\">\n        <Button btnStyle=\"simple\" icon=\"times-circle\" uppercase={false}>\n          Cancel\n        </Button>\n      </Link>\n    );\n\n    return (\n      <Button.Group>\n        {cancelButton}\n\n        <Button\n          disabled={isActionLoading}\n          btnStyle=\"success\"\n          uppercase={false}\n          icon={isActionLoading ? undefined : \"check-circle\"}\n          onClick={this.handleSubmit}\n        >\n          {isActionLoading && <SmallLoader />}\n          Save\n        </Button>\n      </Button.Group>\n    );\n  };\n\n  onChange = (key: string, value: any) => {\n    this.setState({ [key]: value } as any);\n  };\n\n  onFormDocChange = (formData) => {\n    this.setState({ formData });\n  };\n\n  onFormInit = (fields: IField[]) => {\n    const formData = this.state.formData;\n    formData.fields = fields;\n\n    this.setState({ formData });\n  };\n\n  render() {\n    const {\n      activeStep,\n      calloutTitle,\n      type,\n      calloutBtnText,\n      bodyValue,\n      color,\n      theme,\n      logoPreviewUrl,\n      thankContent,\n      carousel,\n      language,\n      title,\n      successAction,\n      isSkip,\n      rules,\n      formData,\n      isRequireOnce,\n    } = this.state;\n\n    const { integration } = this.props;\n    const leadData = integration && integration.leadData;\n    const brand = integration && integration.brand;\n    const breadcrumb = [{ title: __(\"Pop Ups\"), link: \"/leads\" }];\n    const constant = isSkip ? \"form\" : \"callout\";\n\n    const onChange = (e) =>\n      this.onChange(\"title\", (e.currentTarget as HTMLInputElement).value);\n\n    return (\n      <>\n        <Wrapper.Header title={__(\"Leads\")} breadcrumb={breadcrumb} />\n        <StepWrapper>\n          <TitleContainer id=\"CreatePopupsTitle\">\n            <div>{__(\"Title\")}</div>\n            <FormControl\n              required={true}\n              onChange={onChange}\n              defaultValue={title}\n              autoFocus={true}\n            />\n            {this.renderSaveButton()}\n          </TitleContainer>\n          <Steps active={activeStep || 1}>\n            <Step img=\"/images/icons/erxes-04.svg\" title=\"Type\">\n              <ChooseType\n                onChange={this.onChange}\n                type={type}\n                calloutTitle={calloutTitle}\n                calloutBtnText={calloutBtnText}\n                color={color}\n                theme={theme}\n              />\n            </Step>\n            <Step img=\"/images/icons/erxes-03.svg\" title=\"CallOut\">\n              <CallOut\n                onChange={this.onChange}\n                type={type}\n                calloutTitle={calloutTitle}\n                calloutBtnText={calloutBtnText}\n                bodyValue={bodyValue}\n                color={color}\n                theme={theme}\n                image={logoPreviewUrl}\n                skip={isSkip}\n              />\n            </Step>\n            <Step img=\"/images/icons/erxes-12.svg\" title={\"Form\"}>\n              <FormStep\n                type={type}\n                color={color}\n                theme={theme}\n                formId={integration && integration.formId}\n                formData={formData}\n                afterDbSave={this.props.afterFormDbSave}\n                onDocChange={this.onFormDocChange}\n                onInit={this.onFormInit}\n                isReadyToSaveForm={this.props.isReadyToSaveForm}\n              />\n            </Step>\n            <Step img=\"/images/icons/erxes-02.svg\" title=\"Rule\">\n              <ConditionsRule rules={rules || []} onChange={this.onChange} />\n            </Step>\n            <Step img=\"/images/icons/erxes-06.svg\" title=\"Options\">\n              <OptionStep\n                onChange={this.onChange}\n                type={type}\n                color={color}\n                brand={brand}\n                theme={theme}\n                isRequireOnce={isRequireOnce}\n                language={language}\n                formData={formData}\n              />\n            </Step>\n            <Step img=\"/images/icons/erxes-13.svg\" title=\"Thank content\">\n              <SuccessStep\n                onChange={this.onChange}\n                thankContent={thankContent}\n                type={type}\n                color={color}\n                theme={theme}\n                successAction={successAction}\n                leadData={leadData}\n                formId={integration && integration.formId}\n              />\n            </Step>\n            <Step\n              img=\"/images/icons/erxes-19.svg\"\n              title=\"Full Preview\"\n              noButton={true}\n            >\n              <FullPreviewStep\n                onChange={this.onChange}\n                calloutTitle={calloutTitle}\n                calloutBtnText={calloutBtnText}\n                bodyValue={bodyValue}\n                type={type}\n                color={color}\n                theme={theme}\n                image={logoPreviewUrl}\n                thankContent={thankContent}\n                skip={isSkip}\n                carousel={carousel || constant}\n                formData={formData}\n              />\n            </Step>\n          </Steps>\n        </StepWrapper>\n      </>\n    );\n  }\n}\n\nexport default Lead;\n"]},"metadata":{},"sourceType":"module"}