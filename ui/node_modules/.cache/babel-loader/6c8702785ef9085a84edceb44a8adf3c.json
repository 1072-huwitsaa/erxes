{"ast":null,"code":"import _toConsumableArray from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/common/components/Chooser.tsx\";\nimport Button from \"erxes-common-ui/lib/components/button\";\nimport EmptyState from \"modules/common/components/EmptyState\";\nimport FormControl from \"modules/common/components/form/Control\";\nimport ModalTrigger from \"modules/common/components/ModalTrigger\";\nimport { __ } from \"modules/common/utils\";\nimport Icon from \"erxes-common-ui/lib/components/icon\";\nimport React from \"react\";\nimport { ActionTop, Column, Columns, Footer, Title } from \"../styles/chooser\";\nimport { CenterContent, ModalFooter } from \"../styles/main\";\n\nvar CommonChooser =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CommonChooser, _React$Component);\n\n  function CommonChooser(props) {\n    var _this;\n\n    _classCallCheck(this, CommonChooser);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CommonChooser).call(this, props));\n    _this.timer = void 0;\n\n    _this.onSelect = function () {\n      _this.props.onSelect(_this.state.datas);\n\n      _this.props.closeModal();\n    };\n\n    _this.handleChange = function (type, data) {\n      var datas = _this.state.datas;\n\n      if (type === \"plus-1\") {\n        if (_this.props.limit && _this.props.limit === datas.length) {\n          return;\n        }\n\n        _this.setState({\n          datas: [].concat(_toConsumableArray(datas), [data])\n        });\n      } else {\n        _this.setState({\n          datas: datas.filter(function (item) {\n            return item !== data;\n          })\n        });\n      }\n    };\n\n    _this.search = function (e) {\n      if (_this.timer) {\n        clearTimeout(_this.timer);\n      }\n\n      var search = _this.props.search;\n      var value = e.target.value;\n      _this.timer = setTimeout(function () {\n        search(value);\n\n        _this.setState({\n          searchValue: value\n        });\n      }, 500);\n    };\n\n    _this.loadMore = function () {\n      _this.setState({\n        loadmore: false\n      });\n\n      _this.props.search(_this.state.searchValue, true);\n    };\n\n    var _datas = _this.props.data.datas || [];\n\n    _this.state = {\n      datas: _datas,\n      loadmore: true,\n      searchValue: \"\"\n    };\n    return _this;\n  }\n\n  _createClass(CommonChooser, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.clearState();\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(newProps) {\n      var datas = newProps.datas,\n          perPage = newProps.perPage,\n          newItem = newProps.newItem;\n      this.setState({\n        loadmore: datas.length === perPage && datas.length > 0\n      });\n      var resetAssociatedItem = this.props.resetAssociatedItem;\n\n      if (newItem) {\n        this.setState({\n          datas: [].concat(_toConsumableArray(this.state.datas), [newItem])\n        }, function () {\n          if (resetAssociatedItem) {\n            resetAssociatedItem();\n          }\n        });\n      }\n    }\n  }, {\n    key: \"renderRow\",\n    value: function renderRow(data, icon) {\n      var _this2 = this;\n\n      if (icon === \"plus-1\" && this.state.datas.some(function (e) {\n        return e._id === data._id;\n      })) {\n        return null;\n      }\n\n      var onClick = function onClick() {\n        return _this2.handleChange(icon, data);\n      };\n\n      return React.createElement(\"li\", {\n        key: data._id,\n        onClick: onClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      }, this.props.renderName(data), React.createElement(Icon, {\n        icon: icon,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"renderSelected\",\n    value: function renderSelected(selectedDatas) {\n      var _this3 = this;\n\n      if (selectedDatas.length) {\n        return React.createElement(\"ul\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 130\n          },\n          __self: this\n        }, selectedDatas.map(function (data) {\n          return _this3.renderRow(data, \"times\");\n        }));\n      }\n\n      return React.createElement(EmptyState, {\n        text: \"No items added\",\n        icon: \"list-ul\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"content\",\n    value: function content() {\n      var _this4 = this;\n\n      var datas = this.props.datas;\n\n      if (datas.length === 0) {\n        return React.createElement(EmptyState, {\n          text: \"No matching items found\",\n          icon: \"list-ul\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, datas.map(function (dataItem) {\n        return _this4.renderRow(dataItem, \"plus-1\");\n      }), this.state.loadmore && React.createElement(CenterContent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(Button, {\n        size: \"small\",\n        btnStyle: \"primary\",\n        onClick: this.loadMore,\n        icon: \"angle-double-down\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, \"Load More\")));\n    }\n  }, {\n    key: \"renderSubFilter\",\n    value: function renderSubFilter() {\n      var renderFilter = this.props.renderFilter;\n\n      if (!renderFilter) {\n        return;\n      }\n\n      return renderFilter();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          renderForm = _this$props.renderForm,\n          title = _this$props.title,\n          data = _this$props.data,\n          closeModal = _this$props.closeModal;\n      var selectedDatas = this.state.datas;\n      var addTrigger = React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, __(\"Don't see the result you're looking for?\"), React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, __(\"Create a new \".concat(title))));\n      return React.createElement(React.Fragment, null, React.createElement(Columns, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(Column, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(ActionTop, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, React.createElement(FormControl, {\n        placeholder: __(\"Type to search\"),\n        onChange: this.search,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }), this.renderSubFilter()), this.content()), React.createElement(Column, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, React.createElement(Title, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, data.name, \"'s \", title, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, \"(\", selectedDatas.length, \")\")), this.renderSelected(selectedDatas))), React.createElement(ModalFooter, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, React.createElement(Footer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(ModalTrigger, {\n        title: \"New \".concat(title),\n        trigger: addTrigger,\n        size: \"lg\",\n        content: renderForm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, React.createElement(Button, {\n        btnStyle: \"simple\",\n        uppercase: false,\n        onClick: closeModal,\n        icon: \"times-circle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        btnStyle: \"success\",\n        onClick: this.onSelect,\n        icon: \"check-circle\",\n        uppercase: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, \"Select\")))));\n    }\n  }]);\n\n  return CommonChooser;\n}(React.Component);\n\nexport default CommonChooser;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/common/components/Chooser.tsx"],"names":["Button","EmptyState","FormControl","ModalTrigger","__","Icon","React","ActionTop","Column","Columns","Footer","Title","CenterContent","ModalFooter","CommonChooser","props","timer","onSelect","state","datas","closeModal","handleChange","type","data","limit","length","setState","filter","item","search","e","clearTimeout","value","target","setTimeout","searchValue","loadMore","loadmore","clearState","newProps","perPage","newItem","resetAssociatedItem","icon","some","_id","onClick","renderName","selectedDatas","map","renderRow","dataItem","renderFilter","renderForm","title","addTrigger","renderSubFilter","content","name","renderSelected","Component"],"mappings":"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","sourcesContent":["import Button from \"erxes-common-ui/lib/components/button\";\nimport EmptyState from \"modules/common/components/EmptyState\";\nimport FormControl from \"modules/common/components/form/Control\";\nimport ModalTrigger from \"modules/common/components/ModalTrigger\";\nimport { __ } from \"modules/common/utils\";\nimport Icon from \"erxes-common-ui/lib/components/icon\";\nimport { ICompany } from \"modules/companies/types\";\nimport { ICustomer } from \"modules/customers/types\";\nimport React from \"react\";\nimport { ActionTop, Column, Columns, Footer, Title } from \"../styles/chooser\";\nimport { CenterContent, ModalFooter } from \"../styles/main\";\n\nexport type CommonProps = {\n  data: any;\n  search: (value: string, reload?: boolean) => void;\n  datas: any[];\n  title: string;\n  renderName: (data: any) => void;\n  renderForm: (props: { closeModal: () => void }) => any;\n  perPage: number;\n  clearState: () => void;\n  limit?: number;\n  newItem?: string | ICompany | ICustomer;\n  resetAssociatedItem?: () => void;\n  closeModal: () => void;\n  onSelect: (datas: any[]) => void;\n};\n\ntype Props = {\n  renderFilter?: () => any;\n} & CommonProps;\n\ntype State = {\n  datas: any[];\n  loadmore: boolean;\n  searchValue: string;\n};\n\nclass CommonChooser extends React.Component<Props, State> {\n  private timer?: NodeJS.Timer;\n\n  constructor(props) {\n    super(props);\n\n    const datas = this.props.data.datas || [];\n\n    this.state = {\n      datas,\n      loadmore: true,\n      searchValue: \"\",\n    };\n  }\n\n  onSelect = () => {\n    this.props.onSelect(this.state.datas);\n    this.props.closeModal();\n  };\n\n  componentWillUnmount() {\n    this.props.clearState();\n  }\n\n  componentWillReceiveProps(newProps) {\n    const { datas, perPage, newItem } = newProps;\n\n    this.setState({ loadmore: datas.length === perPage && datas.length > 0 });\n\n    const { resetAssociatedItem } = this.props;\n\n    if (newItem) {\n      this.setState({ datas: [...this.state.datas, newItem] }, () => {\n        if (resetAssociatedItem) {\n          resetAssociatedItem();\n        }\n      });\n    }\n  }\n\n  handleChange = (type, data) => {\n    const { datas } = this.state;\n\n    if (type === \"plus-1\") {\n      if (this.props.limit && this.props.limit === datas.length) {\n        return;\n      }\n\n      this.setState({ datas: [...datas, data] });\n    } else {\n      this.setState({ datas: datas.filter((item) => item !== data) });\n    }\n  };\n\n  search = (e) => {\n    if (this.timer) {\n      clearTimeout(this.timer);\n    }\n\n    const { search } = this.props;\n    const value = e.target.value;\n\n    this.timer = setTimeout(() => {\n      search(value);\n      this.setState({ searchValue: value });\n    }, 500);\n  };\n\n  loadMore = () => {\n    this.setState({ loadmore: false });\n    this.props.search(this.state.searchValue, true);\n  };\n\n  renderRow(data, icon) {\n    if (icon === \"plus-1\" && this.state.datas.some((e) => e._id === data._id)) {\n      return null;\n    }\n\n    const onClick = () => this.handleChange(icon, data);\n\n    return (\n      <li key={data._id} onClick={onClick}>\n        {this.props.renderName(data)}\n        <Icon icon={icon} />\n      </li>\n    );\n  }\n\n  renderSelected(selectedDatas) {\n    if (selectedDatas.length) {\n      return (\n        <ul>{selectedDatas.map((data) => this.renderRow(data, \"times\"))}</ul>\n      );\n    }\n\n    return <EmptyState text=\"No items added\" icon=\"list-ul\" />;\n  }\n\n  content() {\n    const { datas } = this.props;\n\n    if (datas.length === 0) {\n      return <EmptyState text=\"No matching items found\" icon=\"list-ul\" />;\n    }\n\n    return (\n      <ul>\n        {datas.map((dataItem) => this.renderRow(dataItem, \"plus-1\"))}\n        {this.state.loadmore && (\n          <CenterContent>\n            <Button\n              size=\"small\"\n              btnStyle=\"primary\"\n              onClick={this.loadMore}\n              icon=\"angle-double-down\"\n            >\n              Load More\n            </Button>\n          </CenterContent>\n        )}\n      </ul>\n    );\n  }\n\n  renderSubFilter() {\n    const { renderFilter } = this.props;\n    if (!renderFilter) {\n      return;\n    }\n\n    return renderFilter();\n  }\n\n  render() {\n    const { renderForm, title, data, closeModal } = this.props;\n    const selectedDatas = this.state.datas;\n\n    const addTrigger = (\n      <p>\n        {__(\"Don't see the result you're looking for?\")}\n        <span>{__(`Create a new ${title}`)}</span>\n      </p>\n    );\n\n    return (\n      <>\n        <Columns>\n          <Column>\n            <ActionTop>\n              <FormControl\n                placeholder={__(\"Type to search\")}\n                onChange={this.search}\n              />\n              {this.renderSubFilter()}\n            </ActionTop>\n            {this.content()}\n          </Column>\n          <Column>\n            <Title>\n              {data.name}\n              &apos;s {title}\n              <span>({selectedDatas.length})</span>\n            </Title>\n            {this.renderSelected(selectedDatas)}\n          </Column>\n        </Columns>\n        <ModalFooter>\n          <Footer>\n            <ModalTrigger\n              title={`New ${title}`}\n              trigger={addTrigger}\n              size=\"lg\"\n              content={renderForm}\n            />\n            <div>\n              <Button\n                btnStyle=\"simple\"\n                uppercase={false}\n                onClick={closeModal}\n                icon=\"times-circle\"\n              >\n                Cancel\n              </Button>\n              <Button\n                btnStyle=\"success\"\n                onClick={this.onSelect}\n                icon=\"check-circle\"\n                uppercase={false}\n              >\n                Select\n              </Button>\n            </div>\n          </Footer>\n        </ModalFooter>\n      </>\n    );\n  }\n}\n\nexport default CommonChooser;\n"]},"metadata":{},"sourceType":"module"}