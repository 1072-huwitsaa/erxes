{"ast":null,"code":"import _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/videoCall/components/VideoCall.tsx\";\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  height: 30px;\\n  width: 100%;\\n  color: #721c24;\\n  background-color: #f8d7da;\\n  line-height: 28px;\\n  text-align: center;\\n  border: 1px solid #f5c6cb;\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  float: left;\\n  \\n  width: auto;\\n  height: auto;\\n  \\n  padding: 0 10px;\\n  margin: 0 20px;\\n  font-size: 13px;\\n  background: #fafafa;\\n  pointer-events: \", \";\\n  opacity: \", \";\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  right: 3px;\\n  top: 3px;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport DailyIframe from '@daily-co/daily-js';\nimport client from 'apolloClient';\nimport gql from 'graphql-tag';\nimport { SimpleButton } from 'modules/common/styles/main';\nimport { __, Alert } from 'modules/common/utils';\nimport React from 'react';\nimport styled from 'styled-components';\nimport styledTS from 'styled-components-ts';\nimport { mutations } from '../graphql';\nvar Control = styled('div')(_templateObject());\nvar ControlBtn = styledTS(styled(SimpleButton))(_templateObject2(), function (props) {\n  return props.disabled && 'none';\n}, function (props) {\n  return props.disabled && '0.9';\n});\nvar Error = styled.div(_templateObject3());\n\nvar VideoCall =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(VideoCall, _React$Component);\n\n  function VideoCall(props) {\n    var _this;\n\n    _classCallCheck(this, VideoCall);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(VideoCall).call(this, props));\n    _this.callFrame = void 0;\n\n    _this.onDelete = function () {\n      var name = _this.props.queryParams.name;\n\n      _this.setState({\n        loading: true\n      });\n\n      client.mutate({\n        mutation: gql(mutations.deleteVideoChatRoom),\n        variables: {\n          name: name\n        }\n      }).then(function (_ref) {\n        var conversationDeleteVideoChatRoom = _ref.data.conversationDeleteVideoChatRoom;\n\n        if (conversationDeleteVideoChatRoom) {\n          window.close();\n\n          _this.setState({\n            loading: false\n          });\n        }\n      }).catch(function (error) {\n        Alert.error(error.message);\n      });\n    };\n\n    _this.startRecording = function () {\n      _this.callFrame.startRecording();\n    };\n\n    _this.stopRecording = function () {\n      _this.callFrame.stopRecording();\n    };\n\n    _this.state = {\n      errorMessage: '',\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(VideoCall, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var url = this.props.queryParams.url;\n      var owner = {\n        url: url\n      };\n      this.callFrame = DailyIframe.createFrame(document.getElementById('call-frame-container'), {});\n      this.callFrame.on('error', function (e) {\n        _this2.setState({\n          errorMessage: e.errorMsg\n        });\n      });\n      this.callFrame.join(owner);\n    }\n  }, {\n    key: \"renderControls\",\n    value: function renderControls() {\n      return React.createElement(Control, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }, React.createElement(ControlBtn, {\n        onClick: this.onDelete,\n        disabled: this.state.loading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, this.state.loading ? __('Please wait...') : __('End call')));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var url = this.props.queryParams.url;\n\n      if (!url) {\n        return;\n      }\n\n      return React.createElement(React.Fragment, null, this.renderControls(), this.state.errorMessage && React.createElement(Error, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }, this.state.errorMessage), React.createElement(\"div\", {\n        id: \"call-frame-container\",\n        style: {\n          width: '100%',\n          height: '100%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return VideoCall;\n}(React.Component);\n\nexport default VideoCall;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/videoCall/components/VideoCall.tsx"],"names":["DailyIframe","client","gql","SimpleButton","__","Alert","React","styled","styledTS","mutations","Control","ControlBtn","props","disabled","Error","div","VideoCall","callFrame","onDelete","name","queryParams","setState","loading","mutate","mutation","deleteVideoChatRoom","variables","then","conversationDeleteVideoChatRoom","data","window","close","catch","error","message","startRecording","stopRecording","state","errorMessage","url","owner","createFrame","document","getElementById","on","e","errorMsg","join","renderControls","width","height","Component"],"mappings":"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","sourcesContent":["import DailyIframe from '@daily-co/daily-js';\nimport client from 'apolloClient';\nimport gql from 'graphql-tag';\nimport { SimpleButton } from 'modules/common/styles/main';\nimport { __, Alert } from 'modules/common/utils';\nimport React from 'react';\nimport styled from 'styled-components';\nimport styledTS from 'styled-components-ts';\nimport { mutations } from '../graphql';\n\nconst Control = styled('div')`\n  position: absolute;\n  right: 3px;\n  top: 3px;\n`;\n\nconst ControlBtn = styledTS<{ disabled?: boolean }>(styled(SimpleButton))`\n  float: left;\n  \n  width: auto;\n  height: auto;\n  \n  padding: 0 10px;\n  margin: 0 20px;\n  font-size: 13px;\n  background: #fafafa;\n  pointer-events: ${props => props.disabled && 'none'};\n  opacity: ${props => props.disabled && '0.9'};\n`;\n\nconst Error = styled.div`\n  position: absolute;\n  height: 30px;\n  width: 100%;\n  color: #721c24;\n  background-color: #f8d7da;\n  line-height: 28px;\n  text-align: center;\n  border: 1px solid #f5c6cb;\n`;\n\ntype Props = {\n  queryParams: any;\n};\n\nclass VideoCall extends React.Component<\n  Props,\n  { loading: boolean; errorMessage: string }\n> {\n  private callFrame;\n\n  constructor(props) {\n    super(props);\n\n    this.state = { errorMessage: '', loading: false };\n  }\n\n  componentDidMount() {\n    const { url } = this.props.queryParams;\n\n    const owner = { url };\n\n    this.callFrame = DailyIframe.createFrame(\n      document.getElementById('call-frame-container'),\n      {}\n    );\n\n    this.callFrame.on('error', e => {\n      this.setState({ errorMessage: e.errorMsg });\n    });\n\n    this.callFrame.join(owner);\n  }\n\n  onDelete = () => {\n    const { name } = this.props.queryParams;\n\n    this.setState({ loading: true });\n    client\n      .mutate({\n        mutation: gql(mutations.deleteVideoChatRoom),\n        variables: { name }\n      })\n      .then(({ data: { conversationDeleteVideoChatRoom } }) => {\n        if (conversationDeleteVideoChatRoom) {\n          window.close();\n          this.setState({ loading: false });\n        }\n      })\n      .catch(error => {\n        Alert.error(error.message);\n      });\n  };\n\n  startRecording = () => {\n    this.callFrame.startRecording();\n  };\n\n  stopRecording = () => {\n    this.callFrame.stopRecording();\n  };\n\n  renderControls() {\n    return (\n      <Control>\n        <ControlBtn onClick={this.onDelete} disabled={this.state.loading}>\n          {this.state.loading ? __('Please wait...') : __('End call')}\n        </ControlBtn>\n      </Control>\n    );\n  }\n\n  render() {\n    const { url } = this.props.queryParams;\n\n    if (!url) {\n      return;\n    }\n\n    return (\n      <>\n        {this.renderControls()}\n        {this.state.errorMessage && <Error>{this.state.errorMessage}</Error>}\n        <div\n          id=\"call-frame-container\"\n          style={{ width: '100%', height: '100%' }}\n        />\n      </>\n    );\n  }\n}\n\nexport default VideoCall;\n"]},"metadata":{},"sourceType":"module"}