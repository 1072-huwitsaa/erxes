{"ast":null,"code":"import _defineProperty from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/integrations/components/messenger/steps/AddOns.tsx\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  position: absolute;\\n  right: 16px;\\n  top: 16px;\\n  background: rgba(0, 0, 0, 0.1);\\n  border-radius: 50%;\\n  width: 24px;\\n  height: 24px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  transition: opacity ease 0.3s;\\n\\n  &:hover {\\n    opacity: 0.8;\\n    cursor: pointer;\\n  }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  padding: 12px 16px 0 16px;\\n  background: #fafafa;\\n  border-radius: 4px;\\n  border: 1px solid #eee;\\n  position: relative;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport Button from 'modules/common/components/Button';\nimport { ControlLabel, FormControl, FormGroup } from 'modules/common/components/form';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport { FlexItem, LeftItem } from 'modules/common/components/step/styles';\nimport Tip from 'modules/common/components/Tip';\nimport { __ } from 'modules/common/utils';\nimport { Options } from 'modules/settings/integrations/styles';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport styled from 'styled-components';\nvar WebsiteItem = styled.div(_templateObject());\nvar RemoveButton = styled.div(_templateObject2());\n\nvar AddOns =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(AddOns, _React$Component);\n\n  function AddOns(props) {\n    var _this;\n\n    _classCallCheck(this, AddOns);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AddOns).call(this, props));\n\n    _this.generateMessengerApps = function () {\n      var _this$state = _this.state,\n          knowledgeBase = _this$state.knowledgeBase,\n          popups = _this$state.popups,\n          websites = _this$state.websites;\n      return {\n        knowledgebases: [{\n          topicId: knowledgeBase\n        }],\n        leads: popups.map(function (el) {\n          return {\n            formCode: el\n          };\n        }),\n        websites: websites\n      };\n    };\n\n    _this.updateMessengerValues = function () {\n      _this.props.handleMessengerApps(_this.generateMessengerApps());\n    };\n\n    _this.renderOption = function (option) {\n      return React.createElement(Options, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, option.label, React.createElement(\"i\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, option.brand && option.brand.name));\n    };\n\n    _this.generateObjectsParams = function (objects) {\n      return objects.map(function (object) {\n        return {\n          value: object.form ? object.form.code : object._id,\n          label: object.name || object.title,\n          brand: object.brand,\n          disabled: object.brand && _this.props.selectedBrand ? _this.props.selectedBrand !== object.brand._id : false\n        };\n      });\n    };\n\n    _this.onChangeKb = function (obj) {\n      _this.setState({\n        knowledgeBase: obj.value\n      }, function () {\n        return _this.updateMessengerValues();\n      });\n    };\n\n    _this.onChangePopups = function (objects) {\n      _this.setState({\n        popups: objects.map(function (el) {\n          return el.value;\n        })\n      }, function () {\n        return _this.updateMessengerValues();\n      });\n    };\n\n    _this.onChangeInput = function (i, type, e) {\n      var _ref = e.target,\n          value = _ref.value;\n\n      var entries = _toConsumableArray(_this.state.websites);\n\n      entries[i] = _objectSpread({}, entries[i], _defineProperty({}, type, value));\n\n      _this.setState({\n        websites: entries\n      }, function () {\n        return _this.updateMessengerValues();\n      });\n    };\n\n    _this.handleRemoveWebsite = function (i) {\n      _this.setState({\n        websites: _this.state.websites.filter(function (item, index) {\n          return index !== i;\n        })\n      }, function () {\n        return _this.updateMessengerValues();\n      });\n    };\n\n    _this.renderRemoveInput = function (i) {\n      if (_this.state.websites.length <= 1) {\n        return null;\n      }\n\n      return React.createElement(Tip, {\n        text: __('Remove'),\n        placement: \"top\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(RemoveButton, {\n        onClick: _this.handleRemoveWebsite.bind(null, i),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        icon: \"times\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      })));\n    };\n\n    _this.onAddMoreInput = function () {\n      _this.setState({\n        websites: [].concat(_toConsumableArray(_this.state.websites), [{\n          url: '',\n          buttonText: '',\n          description: ''\n        }])\n      });\n    };\n\n    var _props$websiteMesseng = props.websiteMessengerApps,\n        websiteMessengerApps = _props$websiteMesseng === void 0 ? [] : _props$websiteMesseng,\n        _props$leadMessengerA = props.leadMessengerApps,\n        leadMessengerApps = _props$leadMessengerA === void 0 ? [] : _props$leadMessengerA,\n        _props$knowledgeBaseM = props.knowledgeBaseMessengerApps,\n        knowledgeBaseMessengerApps = _props$knowledgeBaseM === void 0 ? [] : _props$knowledgeBaseM;\n    var initialWebsites = websiteMessengerApps.map(function (item) {\n      return {\n        url: item.credentials.url,\n        buttonText: item.credentials.buttonText,\n        description: item.credentials.description\n      };\n    });\n    var initialLeads = leadMessengerApps.map(function (item) {\n      return item.credentials.formCode;\n    });\n    var initialKb = knowledgeBaseMessengerApps.length > 0 && knowledgeBaseMessengerApps[0].credentials.topicId;\n    _this.state = {\n      knowledgeBase: initialKb || '',\n      popups: initialLeads || [],\n      websites: initialWebsites || [{\n        url: '',\n        buttonText: '',\n        description: ''\n      }]\n    };\n    return _this;\n  }\n\n  _createClass(AddOns, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          knowledgeBase = _this$state2.knowledgeBase,\n          popups = _this$state2.popups,\n          websites = _this$state2.websites;\n      var _this$props = this.props,\n          leads = _this$props.leads,\n          topics = _this$props.topics;\n      return React.createElement(FlexItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, React.createElement(LeftItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, React.createElement(ControlLabel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, \"Knowledge Base\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, __('Which specific knowledgebase do you want to display in a separate tab in this messenger'), \"?\"), React.createElement(Select, {\n        value: knowledgeBase,\n        options: this.generateObjectsParams(topics),\n        onChange: this.onChangeKb,\n        optionRenderer: this.renderOption,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      })), React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }, React.createElement(ControlLabel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, \"Pop Ups\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, __('Which popup(s) do you want to display in this messenger'), \"?\"), React.createElement(Select, {\n        value: popups,\n        options: this.generateObjectsParams(leads),\n        onChange: this.onChangePopups,\n        optionRenderer: this.renderOption,\n        multi: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      })), React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, React.createElement(ControlLabel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, \"Websites\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, __('Which website(s) do you want to display in this messenger'), \"?\")), websites.map(function (website, index) {\n        return React.createElement(FormGroup, {\n          key: index,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }, React.createElement(WebsiteItem, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 233\n          },\n          __self: this\n        }, React.createElement(FormGroup, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234\n          },\n          __self: this\n        }, React.createElement(ControlLabel, {\n          required: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 235\n          },\n          __self: this\n        }, \"Website Title\"), React.createElement(FormControl, {\n          name: \"description\",\n          onChange: _this2.onChangeInput.bind(null, index, 'description'),\n          required: true,\n          value: website.description,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 236\n          },\n          __self: this\n        })), React.createElement(FormGroup, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 247\n          },\n          __self: this\n        }, React.createElement(ControlLabel, {\n          required: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        }, \"Website Url\"), React.createElement(FormControl, {\n          value: website.url,\n          onChange: _this2.onChangeInput.bind(null, index, 'url'),\n          name: \"url\",\n          required: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 249\n          },\n          __self: this\n        })), React.createElement(FormGroup, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 256\n          },\n          __self: this\n        }, React.createElement(ControlLabel, {\n          required: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 257\n          },\n          __self: this\n        }, \"Button text\"), React.createElement(FormControl, {\n          onChange: _this2.onChangeInput.bind(null, index, 'buttonText'),\n          value: website.buttonText,\n          name: \"buttonText\",\n          required: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 258\n          },\n          __self: this\n        }))), _this2.renderRemoveInput(index));\n      }), React.createElement(Button, {\n        uppercase: false,\n        onClick: this.onAddMoreInput,\n        icon: \"plus-circle\",\n        btnStyle: \"primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, __('Add a Website'))));\n    }\n  }]);\n\n  return AddOns;\n}(React.Component);\n\nexport default AddOns;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/integrations/components/messenger/steps/AddOns.tsx"],"names":["Button","ControlLabel","FormControl","FormGroup","Icon","FlexItem","LeftItem","Tip","__","Options","React","Select","styled","WebsiteItem","div","RemoveButton","AddOns","props","generateMessengerApps","state","knowledgeBase","popups","websites","knowledgebases","topicId","leads","map","el","formCode","updateMessengerValues","handleMessengerApps","renderOption","option","label","brand","name","generateObjectsParams","objects","object","value","form","code","_id","title","disabled","selectedBrand","onChangeKb","obj","setState","onChangePopups","onChangeInput","i","type","e","target","entries","handleRemoveWebsite","filter","item","index","renderRemoveInput","length","bind","onAddMoreInput","url","buttonText","description","websiteMessengerApps","leadMessengerApps","knowledgeBaseMessengerApps","initialWebsites","credentials","initialLeads","initialKb","topics","website","Component"],"mappings":"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","sourcesContent":["import Button from 'modules/common/components/Button';\nimport {\n  ControlLabel,\n  FormControl,\n  FormGroup\n} from 'modules/common/components/form';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport { FlexItem, LeftItem } from 'modules/common/components/step/styles';\nimport Tip from 'modules/common/components/Tip';\nimport { __ } from 'modules/common/utils';\nimport { ITopic } from 'modules/knowledgeBase/types';\nimport { Options } from 'modules/settings/integrations/styles';\nimport {\n  IIntegration,\n  ILeadMessengerApp,\n  IMessengerApps,\n  ITopicMessengerApp,\n  IWebsite,\n  IWebsiteMessengerApp\n} from 'modules/settings/integrations/types';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport styled from 'styled-components';\n\nconst WebsiteItem = styled.div`\n  padding: 12px 16px 0 16px;\n  background: #fafafa;\n  border-radius: 4px;\n  border: 1px solid #eee;\n  position: relative;\n`;\n\nconst RemoveButton = styled.div`\n  position: absolute;\n  right: 16px;\n  top: 16px;\n  background: rgba(0, 0, 0, 0.1);\n  border-radius: 50%;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: opacity ease 0.3s;\n\n  &:hover {\n    opacity: 0.8;\n    cursor: pointer;\n  }\n`;\n\ntype Props = {\n  type?: string;\n  topics: ITopic[];\n  leads: IIntegration[];\n  selectedBrand?: string;\n  leadMessengerApps?: ILeadMessengerApp[];\n  knowledgeBaseMessengerApps?: ITopicMessengerApp[];\n  websiteMessengerApps?: IWebsiteMessengerApp[];\n  handleMessengerApps: (messengerApps: IMessengerApps) => void;\n};\n\ntype State = {\n  knowledgeBase: string;\n  popups: string[];\n  websites: IWebsite[];\n};\n\nclass AddOns extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const {\n      websiteMessengerApps = [],\n      leadMessengerApps = [],\n      knowledgeBaseMessengerApps = []\n    } = props;\n\n    const initialWebsites = websiteMessengerApps.map(item => ({\n      url: item.credentials.url,\n      buttonText: item.credentials.buttonText,\n      description: item.credentials.description\n    }));\n    const initialLeads = leadMessengerApps.map(\n      item => item.credentials.formCode\n    );\n    const initialKb =\n      knowledgeBaseMessengerApps.length > 0 &&\n      knowledgeBaseMessengerApps[0].credentials.topicId;\n\n    this.state = {\n      knowledgeBase: initialKb || '',\n      popups: initialLeads || [],\n      websites: initialWebsites || [\n        { url: '', buttonText: '', description: '' }\n      ]\n    };\n  }\n\n  generateMessengerApps = () => {\n    const { knowledgeBase, popups, websites } = this.state;\n    return {\n      knowledgebases: [{ topicId: knowledgeBase }],\n      leads: popups.map(el => ({ formCode: el })),\n      websites\n    };\n  };\n\n  updateMessengerValues = () => {\n    this.props.handleMessengerApps(this.generateMessengerApps());\n  };\n\n  renderOption = option => {\n    return (\n      <Options>\n        {option.label}\n        <i>{option.brand && option.brand.name}</i>\n      </Options>\n    );\n  };\n\n  generateObjectsParams = objects => {\n    return objects.map(object => ({\n      value: object.form ? object.form.code : object._id,\n      label: object.name || object.title,\n      brand: object.brand,\n      disabled:\n        object.brand && this.props.selectedBrand\n          ? this.props.selectedBrand !== object.brand._id\n          : false\n    }));\n  };\n\n  onChangeKb = obj => {\n    this.setState({ knowledgeBase: obj.value }, () =>\n      this.updateMessengerValues()\n    );\n  };\n\n  onChangePopups = objects => {\n    this.setState({ popups: objects.map(el => el.value) }, () =>\n      this.updateMessengerValues()\n    );\n  };\n\n  onChangeInput = (\n    i: number,\n    type: 'url' | 'description' | 'buttonText',\n    e: React.FormEvent\n  ) => {\n    const { value } = e.target as HTMLInputElement;\n\n    const entries = [...this.state.websites];\n\n    entries[i] = { ...entries[i], [type]: value };\n\n    this.setState({ websites: entries }, () => this.updateMessengerValues());\n  };\n\n  handleRemoveWebsite = (i: number) => {\n    this.setState(\n      { websites: this.state.websites.filter((item, index) => index !== i) },\n      () => this.updateMessengerValues()\n    );\n  };\n\n  renderRemoveInput = (i: number) => {\n    if (this.state.websites.length <= 1) {\n      return null;\n    }\n\n    return (\n      <Tip text={__('Remove')} placement=\"top\">\n        <RemoveButton onClick={this.handleRemoveWebsite.bind(null, i)}>\n          <Icon icon=\"times\" />\n        </RemoveButton>\n      </Tip>\n    );\n  };\n\n  onAddMoreInput = () => {\n    this.setState({\n      websites: [\n        ...this.state.websites,\n        { url: '', buttonText: '', description: '' }\n      ]\n    });\n  };\n\n  render() {\n    const { knowledgeBase, popups, websites } = this.state;\n    const { leads, topics } = this.props;\n\n    return (\n      <FlexItem>\n        <LeftItem>\n          <FormGroup>\n            <ControlLabel>Knowledge Base</ControlLabel>\n            <p>\n              {__(\n                'Which specific knowledgebase do you want to display in a separate tab in this messenger'\n              )}\n              ?\n            </p>\n            <Select\n              value={knowledgeBase}\n              options={this.generateObjectsParams(topics)}\n              onChange={this.onChangeKb}\n              optionRenderer={this.renderOption}\n            />\n          </FormGroup>\n          <FormGroup>\n            <ControlLabel>Pop Ups</ControlLabel>\n            <p>\n              {__('Which popup(s) do you want to display in this messenger')}?\n            </p>\n            <Select\n              value={popups}\n              options={this.generateObjectsParams(leads)}\n              onChange={this.onChangePopups}\n              optionRenderer={this.renderOption}\n              multi={true}\n            />\n          </FormGroup>\n          <FormGroup>\n            <ControlLabel>Websites</ControlLabel>\n            <p>\n              {__('Which website(s) do you want to display in this messenger')}?\n            </p>\n          </FormGroup>\n          {websites.map((website, index) => (\n            <FormGroup key={index}>\n              <WebsiteItem>\n                <FormGroup>\n                  <ControlLabel required={true}>Website Title</ControlLabel>\n                  <FormControl\n                    name=\"description\"\n                    onChange={this.onChangeInput.bind(\n                      null,\n                      index,\n                      'description'\n                    )}\n                    required={true}\n                    value={website.description}\n                  />\n                </FormGroup>\n                <FormGroup>\n                  <ControlLabel required={true}>Website Url</ControlLabel>\n                  <FormControl\n                    value={website.url}\n                    onChange={this.onChangeInput.bind(null, index, 'url')}\n                    name=\"url\"\n                    required={true}\n                  />\n                </FormGroup>\n                <FormGroup>\n                  <ControlLabel required={true}>Button text</ControlLabel>\n                  <FormControl\n                    onChange={this.onChangeInput.bind(\n                      null,\n                      index,\n                      'buttonText'\n                    )}\n                    value={website.buttonText}\n                    name=\"buttonText\"\n                    required={true}\n                  />\n                </FormGroup>\n              </WebsiteItem>\n              {this.renderRemoveInput(index)}\n            </FormGroup>\n          ))}\n          <Button\n            uppercase={false}\n            onClick={this.onAddMoreInput}\n            icon=\"plus-circle\"\n            btnStyle=\"primary\"\n          >\n            {__('Add a Website')}\n          </Button>\n        </LeftItem>\n      </FlexItem>\n    );\n  }\n}\n\nexport default AddOns;\n"]},"metadata":{},"sourceType":"module"}