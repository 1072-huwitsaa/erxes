{"ast":null,"code":"import _defineProperty from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/boards/utils.tsx\";\nimport { STORAGE_BOARD_KEY, STORAGE_PIPELINE_KEY } from 'modules/boards/constants';\nimport { Amount } from 'modules/boards/styles/stage';\nimport React from 'react';\nimport PriorityIndicator from './components/editForm/PriorityIndicator';\n// get options for react-select-plus\nexport function selectOptions() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return array.map(function (item) {\n    return {\n      value: item._id,\n      label: item.name\n    };\n  });\n}\nexport function collectOrders() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return array.map(function (item, index) {\n    return {\n      _id: item._id,\n      order: index\n    };\n  });\n} // a little function to help us with reordering the result\n\nexport var reorder = function reorder(list, startIndex, endIndex) {\n  var result = Array.from(list);\n\n  var _result$splice = result.splice(startIndex, 1),\n      _result$splice2 = _slicedToArray(_result$splice, 1),\n      removed = _result$splice2[0];\n\n  result.splice(endIndex, 0, removed);\n  return result;\n};\nexport var reorderItemMap = function reorderItemMap(_ref) {\n  var _objectSpread3;\n\n  var itemMap = _ref.itemMap,\n      source = _ref.source,\n      destination = _ref.destination;\n\n  var current = _toConsumableArray(itemMap[source.droppableId]);\n\n  var next = _toConsumableArray(itemMap[destination.droppableId]);\n\n  var target = current[source.index];\n\n  if (!target && source.item) {\n    target = source.item;\n  }\n\n  target.modifiedAt = new Date(); // moving to same list\n\n  if (source.droppableId === destination.droppableId) {\n    // drag down, index -1\n    var specInd = source.index < destination.index ? 0 : 1;\n    var aboveItem = next[destination.index - specInd];\n\n    if (source.index !== undefined) {\n      current.splice(source.index, 1);\n    }\n\n    if (destination.index !== undefined) {\n      current.splice(destination.index, 0, target);\n    }\n\n    var updateditemMap = _objectSpread({}, itemMap, _defineProperty({}, source.droppableId, current));\n\n    return {\n      itemMap: updateditemMap,\n      aboveItem: aboveItem,\n      target: target\n    };\n  } // moving to different list\n  // remove from original\n\n\n  if (source.index !== undefined) {\n    current.splice(source.index, 1);\n  } // insert into next\n\n\n  if (destination.index !== undefined && next.length >= destination.index) {\n    next.splice(destination.index, 0, target);\n  }\n\n  var result = _objectSpread({}, itemMap, (_objectSpread3 = {}, _defineProperty(_objectSpread3, source.droppableId, current), _defineProperty(_objectSpread3, destination.droppableId, next), _objectSpread3));\n\n  return {\n    itemMap: result,\n    aboveItem: next[destination.index - 1],\n    target: target\n  };\n};\nexport var getDefaultBoardAndPipelines = function getDefaultBoardAndPipelines() {\n  var defaultBoards = localStorage.getItem(STORAGE_BOARD_KEY) || '{}';\n  var defaultPipelines = localStorage.getItem(STORAGE_PIPELINE_KEY) || '{}';\n  return {\n    defaultBoards: JSON.parse(defaultBoards),\n    defaultPipelines: JSON.parse(defaultPipelines)\n  };\n};\nexport var renderAmount = function renderAmount() {\n  var amount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (Object.keys(amount).length === 0) {\n    return null;\n  }\n\n  return React.createElement(Amount, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, Object.keys(amount).map(function (key) {\n    return React.createElement(\"li\", {\n      key: key,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, amount[key].toLocaleString(), \" \", React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, key));\n  }));\n};\nexport var invalidateCache = function invalidateCache() {\n  localStorage.setItem('cacheInvalidated', 'true');\n};\nexport var toArray = function toArray() {\n  var item = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n  if (item instanceof Array) {\n    return item;\n  }\n\n  return [item];\n};\nexport var renderPriority = function renderPriority(priority) {\n  if (!priority) {\n    return null;\n  }\n\n  return React.createElement(PriorityIndicator, {\n    value: priority,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  });\n};\nexport var generateButtonClass = function generateButtonClass(closeDate, isComplete) {\n  var colorName = '';\n\n  if (isComplete) {\n    colorName = 'green';\n  } else if (closeDate) {\n    var now = new Date();\n    var oneDay = 24 * 60 * 60 * 1000;\n\n    if (new Date(closeDate).getTime() - now.getTime() < oneDay) {\n      colorName = 'yellow';\n    }\n\n    if (now > closeDate) {\n      colorName = 'red';\n    }\n  }\n\n  return colorName;\n};","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/boards/utils.tsx"],"names":["STORAGE_BOARD_KEY","STORAGE_PIPELINE_KEY","Amount","React","PriorityIndicator","selectOptions","array","map","item","value","_id","label","name","collectOrders","index","order","reorder","list","startIndex","endIndex","result","Array","from","splice","removed","reorderItemMap","itemMap","source","destination","current","droppableId","next","target","modifiedAt","Date","specInd","aboveItem","undefined","updateditemMap","length","getDefaultBoardAndPipelines","defaultBoards","localStorage","getItem","defaultPipelines","JSON","parse","renderAmount","amount","Object","keys","key","toLocaleString","invalidateCache","setItem","toArray","renderPriority","priority","generateButtonClass","closeDate","isComplete","colorName","now","oneDay","getTime"],"mappings":"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","sourcesContent":["import {\n  STORAGE_BOARD_KEY,\n  STORAGE_PIPELINE_KEY\n} from 'modules/boards/constants';\nimport { Amount } from 'modules/boards/styles/stage';\nimport React from 'react';\nimport PriorityIndicator from './components/editForm/PriorityIndicator';\nimport { IDraggableLocation, IItem, IItemMap } from './types';\n\ntype Options = {\n  _id: string;\n  name?: string;\n  type?: string;\n  index?: number;\n  itemId?: string;\n};\n\n// get options for react-select-plus\nexport function selectOptions(array: Options[] = []) {\n  return array.map(item => ({ value: item._id, label: item.name }));\n}\n\nexport function collectOrders(array: Options[] = []) {\n  return array.map((item: Options, index: number) => ({\n    _id: item._id,\n    order: index\n  }));\n}\n\n// a little function to help us with reordering the result\nexport const reorder = (\n  list: any[],\n  startIndex: number,\n  endIndex: number\n): any[] => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n\n  result.splice(endIndex, 0, removed);\n\n  return result;\n};\n\ntype ReorderItemMap = {\n  itemMap: IItemMap;\n  source: IDraggableLocation & { item?: IItem };\n  destination: IDraggableLocation;\n};\n\nexport const reorderItemMap = ({\n  itemMap,\n  source,\n  destination\n}: ReorderItemMap) => {\n  const current = [...itemMap[source.droppableId]];\n  const next = [...itemMap[destination.droppableId]];\n\n  let target = current[source.index];\n\n  if (!target && source.item) {\n    target = source.item;\n  }\n\n  target.modifiedAt = new Date();\n\n  // moving to same list\n  if (source.droppableId === destination.droppableId) {\n    // drag down, index -1\n    const specInd = source.index < destination.index ? 0 : 1;\n\n    const aboveItem = next[destination.index - specInd];\n\n    if (source.index !== undefined) {\n      current.splice(source.index, 1);\n    }\n\n    if (destination.index !== undefined) {\n      current.splice(destination.index, 0, target);\n    }\n\n    const updateditemMap = {\n      ...itemMap,\n      [source.droppableId]: current\n    };\n\n    return {\n      itemMap: updateditemMap,\n      aboveItem,\n      target\n    };\n  }\n\n  // moving to different list\n\n  // remove from original\n  if (source.index !== undefined) {\n    current.splice(source.index, 1);\n  }\n\n  // insert into next\n  if (destination.index !== undefined && next.length >= destination.index) {\n    next.splice(destination.index, 0, target);\n  }\n\n  const result = {\n    ...itemMap,\n    [source.droppableId]: current,\n    [destination.droppableId]: next\n  };\n\n  return {\n    itemMap: result,\n    aboveItem: next[destination.index - 1],\n    target\n  };\n};\n\nexport const getDefaultBoardAndPipelines = () => {\n  const defaultBoards = localStorage.getItem(STORAGE_BOARD_KEY) || '{}';\n  const defaultPipelines = localStorage.getItem(STORAGE_PIPELINE_KEY) || '{}';\n\n  return {\n    defaultBoards: JSON.parse(defaultBoards),\n    defaultPipelines: JSON.parse(defaultPipelines)\n  };\n};\n\nexport const renderAmount = (amount = {}) => {\n  if (Object.keys(amount).length === 0) {\n    return null;\n  }\n\n  return (\n    <Amount>\n      {Object.keys(amount).map(key => (\n        <li key={key}>\n          {amount[key].toLocaleString()} <span>{key}</span>\n        </li>\n      ))}\n    </Amount>\n  );\n};\n\nexport const invalidateCache = () => {\n  localStorage.setItem('cacheInvalidated', 'true');\n};\n\nexport const toArray = (item: string | string[] = []) => {\n  if (item instanceof Array) {\n    return item;\n  }\n\n  return [item];\n};\n\nexport const renderPriority = (priority?: string) => {\n  if (!priority) {\n    return null;\n  }\n\n  return <PriorityIndicator value={priority} />;\n};\n\nexport const generateButtonClass = (closeDate: Date, isComplete?: boolean) => {\n  let colorName = '';\n\n  if (isComplete) {\n    colorName = 'green';\n  } else if (closeDate) {\n    const now = new Date();\n    const oneDay = 24 * 60 * 60 * 1000;\n\n    if (new Date(closeDate).getTime() - now.getTime() < oneDay) {\n      colorName = 'yellow';\n    }\n\n    if (now > closeDate) {\n      colorName = 'red';\n    }\n  }\n\n  return colorName;\n};\n"]},"metadata":{},"sourceType":"module"}