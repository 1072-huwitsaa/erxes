{"ast":null,"code":"import _objectSpread from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _defineProperty from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/logs/components/LogList.tsx\";\nimport Datetime from '@nateradebaugh/react-datetime';\nimport dayjs from 'dayjs';\nimport _ from 'lodash';\nimport Button from 'modules/common/components/Button';\nimport DataWithLoader from 'modules/common/components/DataWithLoader';\nimport EmptyState from 'modules/common/components/EmptyState';\nimport Pagination from 'modules/common/components/pagination/Pagination';\nimport Table from 'modules/common/components/table';\nimport { __, router } from 'modules/common/utils';\nimport Wrapper from 'modules/layout/components/Wrapper';\nimport { FilterItem, FilterWrapper } from 'modules/settings/permissions/styles';\nimport SelectTeamMembers from 'modules/settings/team/containers/SelectTeamMembers';\nimport * as React from 'react';\nimport Select from 'react-select-plus';\nimport LogRow from './LogRow';\nvar actionOptions = [{\n  value: 'create',\n  label: __('Create')\n}, {\n  value: 'update',\n  label: __('Update')\n}, {\n  value: 'delete',\n  label: __('Delete')\n}]; // module names are saved exactly as these values in backend\n// consider both ends when changing\n\nvar moduleOptions = [{\n  value: 'board',\n  label: 'Boards'\n}, {\n  value: 'dealBoards',\n  label: 'Deal boards'\n}, {\n  value: 'taskBoards',\n  label: 'Task boards'\n}, {\n  value: 'ticketBoards',\n  label: 'Ticket boards'\n}, {\n  value: 'growthHackBoards',\n  label: 'Growth hack boards'\n}, {\n  value: 'dealPipelines',\n  label: 'Deal pipelines'\n}, {\n  value: 'taskPipelines',\n  label: 'Task pipelines'\n}, {\n  value: 'ticketPipelines',\n  label: 'Ticket pipelines'\n}, {\n  value: 'growthHackPipelines',\n  label: 'Growth hack pipelines'\n}, {\n  value: 'checklist',\n  label: 'Checklists'\n}, {\n  value: 'checkListItem',\n  label: 'Checklist items'\n}, {\n  value: 'brand',\n  label: 'Brands'\n}, {\n  value: 'channel',\n  label: 'Channels'\n}, {\n  value: 'company',\n  label: 'Companies'\n}, {\n  value: 'customer',\n  label: 'Customers'\n}, {\n  value: 'deal',\n  label: 'Deals'\n}, {\n  value: 'emailTemplate',\n  label: 'Email templates'\n}, {\n  value: 'importHistory',\n  label: 'Import histories'\n}, {\n  value: 'product',\n  label: 'Products'\n}, {\n  value: 'product-category',\n  label: 'Product categories'\n}, {\n  value: 'responseTemplate',\n  label: 'Response templates'\n}, {\n  value: 'tag',\n  label: 'Tags'\n}, {\n  value: 'task',\n  label: 'Tasks'\n}, {\n  value: 'ticket',\n  label: 'Tickets'\n}, {\n  value: 'permission',\n  label: 'Permissions'\n}, {\n  value: 'user',\n  label: 'Users'\n}, {\n  value: 'knowledgeBaseTopic',\n  label: 'Knowledgebase topics'\n}, {\n  value: 'knowledgeBaseCategory',\n  label: 'Knowledgebase categories'\n}, {\n  value: 'knowledgeBaseArticle',\n  label: 'Knowledgebase articles'\n}, {\n  value: 'userGroup',\n  label: 'User groups'\n}, {\n  value: 'internalNote',\n  label: 'Internal notes'\n}, {\n  value: 'pipelineLabel',\n  label: 'Pipeline labels'\n}, {\n  value: 'pipelineTemplate',\n  label: 'Pipeline templates'\n}, {\n  value: 'growthHack',\n  label: 'Growth hacks'\n}, {\n  value: 'integration',\n  label: 'Integrations'\n}, {\n  value: 'segment',\n  label: 'Segments'\n}, {\n  value: 'engage',\n  label: 'Engages'\n}, {\n  value: 'script',\n  label: 'Scripts'\n}];\nvar breadcrumb = [{\n  title: 'Settings',\n  link: '/settings'\n}, {\n  title: __('Logs')\n}];\n\nvar LogList =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LogList, _React$Component);\n\n  function LogList(_props) {\n    var _this;\n\n    _classCallCheck(this, LogList);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LogList).call(this, _props));\n\n    _this.onClick = function () {\n      var history = _this.props.history;\n      var _this$state = _this.state,\n          start = _this$state.start,\n          end = _this$state.end,\n          action = _this$state.action,\n          userId = _this$state.userId,\n          type = _this$state.type;\n      router.setParams(history, {\n        start: start,\n        end: end,\n        action: action,\n        userId: userId,\n        type: type\n      });\n    };\n\n    _this.renderDateFilter = function (name) {\n      var props = {\n        value: _this.state[name],\n        onChange: _this.onDateChange.bind(_assertThisInitialized(_this), name),\n        inputProps: {\n          placeholder: \"\".concat(__(\"Choose \".concat(name, \" date\")))\n        }\n      };\n      return React.createElement(FilterItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, React.createElement(Datetime, Object.assign({}, props, {\n        dateFormat: \"YYYY/MM/DD\",\n        timeFormat: \"HH:mm\",\n        closeOnSelect: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      })));\n    };\n\n    var qp = _props.queryParams || {\n      start: '',\n      end: '',\n      action: '',\n      userId: '',\n      type: ''\n    };\n    _this.state = {\n      start: qp.start,\n      end: qp.end,\n      action: qp.action,\n      userId: qp.userId,\n      type: qp.type\n    };\n    return _this;\n  }\n\n  _createClass(LogList, [{\n    key: \"setFilter\",\n    value: function setFilter(name, selectedItem) {\n      var _this$setState;\n\n      var value = typeof selectedItem === 'string' ? selectedItem : selectedItem ? selectedItem.value : '';\n      this.setState((_this$setState = {}, _defineProperty(_this$setState, name, value), _defineProperty(_this$setState, \"page\", ''), _defineProperty(_this$setState, \"perPage\", ''), _this$setState));\n    }\n  }, {\n    key: \"onDateChange\",\n    value: function onDateChange(type, date) {\n      var filter = _objectSpread({}, this.state);\n\n      if (date) {\n        filter[type] = dayjs(date).format('YYYY-MM-DD HH:mm');\n      } else {\n        filter.start = '';\n        filter.end = '';\n      }\n\n      this.setState(filter);\n    }\n  }, {\n    key: \"renderObjects\",\n    value: function renderObjects() {\n      var logs = this.props.logs;\n      var rows = [];\n\n      if (!logs) {\n        return rows;\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = logs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var log = _step.value;\n          rows.push(React.createElement(LogRow, {\n            key: log._id,\n            log: log,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 169\n            },\n            __self: this\n          }));\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return rows;\n    }\n  }, {\n    key: \"renderContent\",\n    value: function renderContent() {\n      return React.createElement(Table, {\n        whiteSpace: \"wrap\",\n        hover: true,\n        bordered: true,\n        condensed: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, __('Date')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, __('Created by')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, __('Module')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, __('Action')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, __('Description')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, __('Changes')))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, this.renderObjects()));\n    }\n  }, {\n    key: \"renderActionBar\",\n    value: function renderActionBar() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          action = _this$state2.action,\n          userId = _this$state2.userId,\n          type = _this$state2.type;\n\n      var onUserChange = function onUserChange(user) {\n        _this2.setFilter('userId', user);\n      };\n\n      var actionBarLeft = React.createElement(FilterWrapper, {\n        style: {\n          padding: '10px 0px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, React.createElement(\"strong\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, __('Filters'), \":\"), this.renderDateFilter('start'), this.renderDateFilter('end'), React.createElement(FilterItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, React.createElement(Select, {\n        placeholder: __('Choose module'),\n        value: type,\n        options: _.sortBy(moduleOptions, ['label']),\n        onChange: this.setFilter.bind(this, 'type'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      })), React.createElement(FilterItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(Select, {\n        placeholder: __('Choose action'),\n        value: action,\n        options: actionOptions,\n        onChange: this.setFilter.bind(this, 'action'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      })), React.createElement(FilterItem, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(SelectTeamMembers, {\n        label: \"Choose users\",\n        name: \"userId\",\n        value: userId || '',\n        onSelect: onUserChange,\n        multi: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      })), React.createElement(Button, {\n        btnStyle: \"primary\",\n        icon: \"filter-1\",\n        uppercase: false,\n        onClick: this.onClick,\n        size: \"small\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, __('Filter')));\n      return React.createElement(Wrapper.ActionBar, {\n        background: \"colorWhite\",\n        left: actionBarLeft,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          isLoading = _this$props.isLoading,\n          count = _this$props.count,\n          errorMessage = _this$props.errorMessage;\n\n      if (errorMessage.indexOf('Permission required') !== -1) {\n        return React.createElement(EmptyState, {\n          text: __('Permission denied'),\n          image: \"/images/actions/21.svg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 271\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(Wrapper, {\n        header: React.createElement(Wrapper.Header, {\n          title: __('Logs'),\n          breadcrumb: breadcrumb,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280\n          },\n          __self: this\n        }),\n        actionBar: this.renderActionBar(),\n        footer: React.createElement(Pagination, {\n          count: count,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 282\n          },\n          __self: this\n        }),\n        content: React.createElement(DataWithLoader, {\n          data: this.renderContent(),\n          loading: isLoading,\n          count: count,\n          emptyText: __('There are no logs recorded'),\n          emptyImage: \"/images/actions/21.svg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 284\n          },\n          __self: this\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return LogList;\n}(React.Component);\n\nexport default LogList;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/logs/components/LogList.tsx"],"names":["Datetime","dayjs","_","Button","DataWithLoader","EmptyState","Pagination","Table","__","router","Wrapper","FilterItem","FilterWrapper","SelectTeamMembers","React","Select","LogRow","actionOptions","value","label","moduleOptions","breadcrumb","title","link","LogList","props","onClick","history","state","start","end","action","userId","type","setParams","renderDateFilter","name","onChange","onDateChange","bind","inputProps","placeholder","qp","queryParams","selectedItem","setState","date","filter","format","logs","rows","log","push","_id","renderObjects","onUserChange","user","setFilter","actionBarLeft","padding","sortBy","isLoading","count","errorMessage","indexOf","renderActionBar","renderContent","Component"],"mappings":"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","sourcesContent":["import Datetime from '@nateradebaugh/react-datetime';\nimport dayjs from 'dayjs';\nimport _ from 'lodash';\nimport Button from 'modules/common/components/Button';\nimport DataWithLoader from 'modules/common/components/DataWithLoader';\nimport EmptyState from 'modules/common/components/EmptyState';\nimport Pagination from 'modules/common/components/pagination/Pagination';\nimport Table from 'modules/common/components/table';\nimport { __, router } from 'modules/common/utils';\nimport Wrapper from 'modules/layout/components/Wrapper';\nimport { FilterItem, FilterWrapper } from 'modules/settings/permissions/styles';\nimport SelectTeamMembers from 'modules/settings/team/containers/SelectTeamMembers';\nimport * as React from 'react';\nimport Select from 'react-select-plus';\nimport { ILog } from '../types';\nimport LogRow from './LogRow';\n\ntype Props = {\n  history: any;\n  queryParams: any;\n  isLoading: boolean;\n  errorMessage: string;\n} & commonProps;\n\ntype State = {\n  start?: string;\n  end?: string;\n  action?: string;\n  page?: string;\n  perPage?: string;\n  userId?: string;\n  type?: string;\n};\n\ntype commonProps = {\n  logs: ILog[];\n  count: number;\n  refetchQueries: any;\n};\n\nconst actionOptions = [\n  { value: 'create', label: __('Create') },\n  { value: 'update', label: __('Update') },\n  { value: 'delete', label: __('Delete') }\n];\n\n// module names are saved exactly as these values in backend\n// consider both ends when changing\nconst moduleOptions = [\n  { value: 'board', label: 'Boards' },\n  { value: 'dealBoards', label: 'Deal boards' },\n  { value: 'taskBoards', label: 'Task boards' },\n  { value: 'ticketBoards', label: 'Ticket boards' },\n  { value: 'growthHackBoards', label: 'Growth hack boards' },\n  { value: 'dealPipelines', label: 'Deal pipelines' },\n  { value: 'taskPipelines', label: 'Task pipelines' },\n  { value: 'ticketPipelines', label: 'Ticket pipelines' },\n  { value: 'growthHackPipelines', label: 'Growth hack pipelines' },\n  { value: 'checklist', label: 'Checklists' },\n  { value: 'checkListItem', label: 'Checklist items' },\n  { value: 'brand', label: 'Brands' },\n  { value: 'channel', label: 'Channels' },\n  { value: 'company', label: 'Companies' },\n  { value: 'customer', label: 'Customers' },\n  { value: 'deal', label: 'Deals' },\n  { value: 'emailTemplate', label: 'Email templates' },\n  { value: 'importHistory', label: 'Import histories' },\n  { value: 'product', label: 'Products' },\n  { value: 'product-category', label: 'Product categories' },\n  { value: 'responseTemplate', label: 'Response templates' },\n  { value: 'tag', label: 'Tags' },\n  { value: 'task', label: 'Tasks' },\n  { value: 'ticket', label: 'Tickets' },\n  { value: 'permission', label: 'Permissions' },\n  { value: 'user', label: 'Users' },\n  { value: 'knowledgeBaseTopic', label: 'Knowledgebase topics' },\n  { value: 'knowledgeBaseCategory', label: 'Knowledgebase categories' },\n  { value: 'knowledgeBaseArticle', label: 'Knowledgebase articles' },\n  { value: 'userGroup', label: 'User groups' },\n  { value: 'internalNote', label: 'Internal notes' },\n  { value: 'pipelineLabel', label: 'Pipeline labels' },\n  { value: 'pipelineTemplate', label: 'Pipeline templates' },\n  { value: 'growthHack', label: 'Growth hacks' },\n  { value: 'integration', label: 'Integrations' },\n  { value: 'segment', label: 'Segments' },\n  { value: 'engage', label: 'Engages' },\n  { value: 'script', label: 'Scripts' }\n];\n\nconst breadcrumb = [\n  { title: 'Settings', link: '/settings' },\n  { title: __('Logs') }\n];\n\nclass LogList extends React.Component<Props, State> {\n  constructor(props) {\n    super(props);\n\n    const qp = props.queryParams || {\n      start: '',\n      end: '',\n      action: '',\n      userId: '',\n      type: ''\n    };\n\n    this.state = {\n      start: qp.start,\n      end: qp.end,\n      action: qp.action,\n      userId: qp.userId,\n      type: qp.type\n    };\n  }\n\n  setFilter(\n    name: string,\n    selectedItem: string & { value: string; label?: string }\n  ) {\n    const value =\n      typeof selectedItem === 'string'\n        ? selectedItem\n        : selectedItem\n        ? selectedItem.value\n        : '';\n\n    this.setState({\n      [name]: value,\n      page: '',\n      perPage: ''\n    });\n  }\n\n  onDateChange(type: string, date) {\n    const filter = { ...this.state };\n\n    if (date) {\n      filter[type] = dayjs(date).format('YYYY-MM-DD HH:mm');\n    } else {\n      filter.start = '';\n      filter.end = '';\n    }\n\n    this.setState(filter);\n  }\n\n  onClick = () => {\n    const { history } = this.props;\n    const { start, end, action, userId, type } = this.state;\n\n    router.setParams(history, {\n      start,\n      end,\n      action,\n      userId,\n      type\n    });\n  };\n\n  renderObjects() {\n    const { logs } = this.props;\n    const rows: JSX.Element[] = [];\n\n    if (!logs) {\n      return rows;\n    }\n\n    for (const log of logs) {\n      rows.push(<LogRow key={log._id} log={log} />);\n    }\n\n    return rows;\n  }\n\n  renderContent() {\n    return (\n      <Table whiteSpace=\"wrap\" hover={true} bordered={true} condensed={true}>\n        <thead>\n          <tr>\n            <th>{__('Date')}</th>\n            <th>{__('Created by')}</th>\n            <th>{__('Module')}</th>\n            <th>{__('Action')}</th>\n            <th>{__('Description')}</th>\n            <th>{__('Changes')}</th>\n          </tr>\n        </thead>\n        <tbody>{this.renderObjects()}</tbody>\n      </Table>\n    );\n  }\n\n  renderDateFilter = (name: string) => {\n    const props = {\n      value: this.state[name],\n      onChange: this.onDateChange.bind(this, name),\n      inputProps: {\n        placeholder: `${__(`Choose ${name} date`)}`\n      }\n    };\n\n    return (\n      <FilterItem>\n        <Datetime\n          {...props}\n          dateFormat=\"YYYY/MM/DD\"\n          timeFormat=\"HH:mm\"\n          closeOnSelect={true}\n        />\n      </FilterItem>\n    );\n  };\n\n  renderActionBar() {\n    const { action, userId, type } = this.state;\n\n    const onUserChange = user => {\n      this.setFilter('userId', user);\n    };\n\n    const actionBarLeft = (\n      <FilterWrapper style={{ padding: '10px 0px' }}>\n        <strong>{__('Filters')}:</strong>\n        {this.renderDateFilter('start')}\n        {this.renderDateFilter('end')}\n        <FilterItem>\n          <Select\n            placeholder={__('Choose module')}\n            value={type}\n            options={_.sortBy(moduleOptions, ['label'])}\n            onChange={this.setFilter.bind(this, 'type')}\n          />\n        </FilterItem>\n        <FilterItem>\n          <Select\n            placeholder={__('Choose action')}\n            value={action}\n            options={actionOptions}\n            onChange={this.setFilter.bind(this, 'action')}\n          />\n        </FilterItem>\n        <FilterItem>\n          <SelectTeamMembers\n            label=\"Choose users\"\n            name=\"userId\"\n            value={userId || ''}\n            onSelect={onUserChange}\n            multi={false}\n          />\n        </FilterItem>\n        <Button\n          btnStyle=\"primary\"\n          icon=\"filter-1\"\n          uppercase={false}\n          onClick={this.onClick}\n          size=\"small\"\n        >\n          {__('Filter')}\n        </Button>\n      </FilterWrapper>\n    );\n\n    return <Wrapper.ActionBar background=\"colorWhite\" left={actionBarLeft} />;\n  }\n\n  render() {\n    const { isLoading, count, errorMessage } = this.props;\n\n    if (errorMessage.indexOf('Permission required') !== -1) {\n      return (\n        <EmptyState\n          text={__('Permission denied')}\n          image=\"/images/actions/21.svg\"\n        />\n      );\n    }\n\n    return (\n      <Wrapper\n        header={<Wrapper.Header title={__('Logs')} breadcrumb={breadcrumb} />}\n        actionBar={this.renderActionBar()}\n        footer={<Pagination count={count} />}\n        content={\n          <DataWithLoader\n            data={this.renderContent()}\n            loading={isLoading}\n            count={count}\n            emptyText={__('There are no logs recorded')}\n            emptyImage=\"/images/actions/21.svg\"\n          />\n        }\n      />\n    );\n  }\n}\n\nexport default LogList;\n"]},"metadata":{},"sourceType":"module"}