{"ast":null,"code":"import _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/deals/components/product/ProductItem.tsx\";\nimport FormControl from 'modules/common/components/form/Control';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport ModalTrigger from 'modules/common/components/ModalTrigger';\nimport CURRENCIES from 'modules/common/constants/currencies';\nimport { __ } from 'modules/common/utils';\nimport { MEASUREMENTS } from 'modules/settings/general/constants';\nimport SelectTeamMembers from 'modules/settings/team/containers/SelectTeamMembers';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport ProductChooser from '../../containers/product/ProductChooser';\nimport { Amount, ContentColumn, ContentRow, ItemRow, ItemText, Measure, ProductButton, ProductItemContainer, ProductSettings } from '../../styles';\nimport { selectConfigOptions } from '../../utils';\nimport ProductRow from './ProductRow';\n\nvar ProductItem =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ProductItem, _React$Component);\n\n  function ProductItem(props) {\n    var _this;\n\n    _classCallCheck(this, ProductItem);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProductItem).call(this, props));\n\n    _this.componentDidMount = function () {\n      // default select item\n      var _this$props = _this.props,\n          uom = _this$props.uom,\n          currencies = _this$props.currencies,\n          productData = _this$props.productData;\n\n      if (uom.length > 0 && !productData.uom) {\n        _this.onChangeField('uom', uom[0], productData._id);\n      }\n\n      if (currencies.length > 0 && !productData.currency) {\n        _this.onChangeField('currency', currencies[0], productData._id);\n      } // select previous assignee when add new product\n\n\n      var tempAssignee = localStorage.getItem('temporaryAssignee');\n\n      if (!productData.assignUserId && tempAssignee && !productData.product) {\n        _this.onChangeField('assignUserId', tempAssignee, productData._id);\n      }\n    };\n\n    _this.calculateAmount = function (type, productData) {\n      var amount = productData.unitPrice * productData.quantity;\n\n      if (amount > 0) {\n        if (type === 'discount') {\n          productData.discountPercent = productData.discount * 100 / amount;\n        } else {\n          productData.discount = amount * productData.discountPercent / 100;\n        }\n\n        productData.tax = (amount - productData.discount || 0) * productData.taxPercent / 100;\n        productData.amount = amount - (productData.discount || 0) + (productData.tax || 0);\n      } else {\n        productData.tax = 0;\n        productData.discount = 0;\n        productData.amount = 0;\n      }\n\n      var updateTotal = _this.props.updateTotal;\n\n      if (updateTotal) {\n        updateTotal();\n      }\n    };\n\n    _this.onChangeCategory = function (categoryId) {\n      _this.setState({\n        categoryId: categoryId\n      });\n    };\n\n    _this.onChangeField = function (type, value, productId) {\n      var _this$props2 = _this.props,\n          productsData = _this$props2.productsData,\n          onChangeProductsData = _this$props2.onChangeProductsData;\n\n      if (productsData) {\n        var productData = productsData.find(function (p) {\n          return p._id === productId;\n        });\n\n        if (productData) {\n          if (type === 'product') {\n            var product = value;\n            productData.unitPrice = product.unitPrice;\n            productData.currency = productData.currency || _this.props.currencies[0];\n          }\n\n          productData[type] = value;\n        }\n\n        if (type !== 'uom' && productData) {\n          _this.calculateAmount(type, productData);\n        }\n\n        if (onChangeProductsData) {\n          onChangeProductsData(productsData);\n        }\n      }\n    };\n\n    _this.uomOnChange = function (option) {\n      return _this.onChangeField('uom', option ? option.value : '', _this.props.productData._id);\n    };\n\n    _this.currencyOnChange = function (currency) {\n      return _this.onChangeField('currency', currency ? currency.value : '', _this.props.productData._id);\n    };\n\n    _this.onChange = function (e) {\n      return _this.onChangeField(e.target.name, e.target.value, _this.props.productData._id);\n    };\n\n    _this.onClick = function () {\n      var _this$props3 = _this.props,\n          productData = _this$props3.productData,\n          removeProductItem = _this$props3.removeProductItem;\n      return removeProductItem && removeProductItem(productData._id);\n    };\n\n    _this.onTickUse = function (e) {\n      var isChecked = e.currentTarget.checked;\n\n      _this.onChangeField('tickUsed', isChecked, _this.props.productData._id);\n    };\n\n    _this.assignUserOnChange = function (userId) {\n      localStorage.setItem('temporaryAssignee', userId);\n\n      _this.onChangeField('assignUserId', userId, _this.props.productData._id);\n    };\n\n    _this.changeCurrentProduct = function (productId) {\n      _this.setState({\n        currentProduct: _this.state.currentProduct === productId ? '' : productId\n      });\n    };\n\n    _this.renderForm = function () {\n      var _this$props4 = _this.props,\n          productData = _this$props4.productData,\n          uom = _this$props4.uom,\n          currencies = _this$props4.currencies;\n\n      var selectOption = function selectOption(option) {\n        return React.createElement(\"div\", {\n          className: \"simple-option\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 234\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 235\n          },\n          __self: this\n        }, option.label));\n      };\n\n      if (!productData.product || _this.state.currentProduct === productData.product._id) {\n        return React.createElement(ProductItemContainer, {\n          key: productData._id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 244\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 245\n          },\n          __self: this\n        }, React.createElement(ProductSettings, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246\n          },\n          __self: this\n        }, React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 247\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 248\n          },\n          __self: this\n        }, __('Tick paid or used'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 249\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          componentClass: \"checkbox\",\n          checked: productData.tickUsed,\n          onChange: _this.onTickUse,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 250\n          },\n          __self: this\n        }))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 257\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 258\n          },\n          __self: this\n        }, __('UOM'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 259\n          },\n          __self: this\n        }, React.createElement(Select, {\n          name: \"uom\",\n          placeholder: __('Choose'),\n          value: productData.uom,\n          onChange: _this.uomOnChange,\n          optionRenderer: selectOption,\n          options: selectConfigOptions(uom, MEASUREMENTS),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 260\n          },\n          __self: this\n        }))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 270\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 271\n          },\n          __self: this\n        }, __('Currency'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 272\n          },\n          __self: this\n        }, React.createElement(Select, {\n          name: \"currency\",\n          placeholder: __('Choose'),\n          value: productData.currency,\n          onChange: _this.currencyOnChange,\n          optionRenderer: selectOption,\n          options: selectConfigOptions(currencies, CURRENCIES),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273\n          },\n          __self: this\n        }))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 283\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 284\n          },\n          __self: this\n        }, __('Assigned to'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 285\n          },\n          __self: this\n        }, React.createElement(SelectTeamMembers, {\n          label: \"Choose assigned user\",\n          name: \"assignedUserId\",\n          multi: false,\n          customOption: {\n            value: '',\n            label: '-----------'\n          },\n          value: productData.assignUserId,\n          onSelect: _this.assignUserOnChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 286\n          },\n          __self: this\n        })))), React.createElement(ContentColumn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 300\n          },\n          __self: this\n        }, React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 301\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 302\n          },\n          __self: this\n        }, __('Choose Product'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 303\n          },\n          __self: this\n        }, _this.renderProductModal(productData))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 307\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308\n          },\n          __self: this\n        }, __('Quantity'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 309\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          defaultValue: productData.quantity || 0,\n          type: \"number\",\n          min: 1,\n          placeholder: \"0\",\n          name: \"quantity\",\n          onChange: _this.onChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 310\n          },\n          __self: this\n        }))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 320\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 321\n          },\n          __self: this\n        }, __('Unit price'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 322\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          value: productData.unitPrice || '',\n          type: \"number\",\n          placeholder: \"0\",\n          name: \"unitPrice\",\n          onChange: _this.onChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 323\n          },\n          __self: this\n        }))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 332\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 333\n          },\n          __self: this\n        }, __('Amount'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 334\n          },\n          __self: this\n        }, React.createElement(Amount, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 335\n          },\n          __self: this\n        }, (productData.quantity * productData.unitPrice).toLocaleString(), ' ', React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 339\n          },\n          __self: this\n        }, productData.currency)))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 343\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 344\n          },\n          __self: this\n        }, __('Discount'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 345\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 346\n          },\n          __self: this\n        }, React.createElement(ContentColumn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 347\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 348\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          value: productData.discountPercent || '',\n          type: \"number\",\n          min: 0,\n          max: 100,\n          placeholder: \"0\",\n          name: \"discountPercent\",\n          onChange: _this.onChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 349\n          },\n          __self: this\n        }), React.createElement(Measure, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 358\n          },\n          __self: this\n        }, \"%\"))), React.createElement(ContentColumn, {\n          flex: \"2\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 361\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 362\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          value: productData.discount || '',\n          type: \"number\",\n          placeholder: \"0\",\n          name: \"discount\",\n          onChange: _this.onChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 363\n          },\n          __self: this\n        }), React.createElement(Measure, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 370\n          },\n          __self: this\n        }, productData.currency)))))), React.createElement(ItemRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 377\n          },\n          __self: this\n        }, React.createElement(ItemText, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 378\n          },\n          __self: this\n        }, __('Tax'), \":\"), React.createElement(ContentColumn, {\n          flex: \"3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 379\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 380\n          },\n          __self: this\n        }, React.createElement(ContentColumn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 381\n          },\n          __self: this\n        }, React.createElement(ContentRow, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 382\n          },\n          __self: this\n        }, React.createElement(FormControl, {\n          defaultValue: productData.taxPercent || '',\n          type: \"number\",\n          min: 0,\n          max: 100,\n          placeholder: \"0\",\n          name: \"taxPercent\",\n          onChange: _this.onChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 383\n          },\n          __self: this\n        }), React.createElement(Measure, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 392\n          },\n          __self: this\n        }, \"%\"))), React.createElement(ContentColumn, {\n          flex: \"2\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 395\n          },\n          __self: this\n        }, React.createElement(Amount, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 396\n          },\n          __self: this\n        }, (productData.tax || 0).toLocaleString(), ' ', React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 398\n          },\n          __self: this\n        }, productData.currency)))))))));\n      }\n\n      return null;\n    };\n\n    _this.state = {\n      categoryId: '',\n      currentProduct: props.currentProduct\n    };\n    return _this;\n  }\n\n  _createClass(ProductItem, [{\n    key: \"renderProductServiceTrigger\",\n    value: function renderProductServiceTrigger(product) {\n      var content = React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, __('Choose Product & Service'), \" \", React.createElement(Icon, {\n        icon: \"plus-circle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      })); // if product selected\n\n      if (product) {\n        content = React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }, product.name, \" \", React.createElement(Icon, {\n          icon: \"pen-1\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        }));\n      }\n\n      return React.createElement(ProductButton, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, content);\n    }\n  }, {\n    key: \"renderProductModal\",\n    value: function renderProductModal(productData) {\n      var _this2 = this;\n\n      var productOnChange = function productOnChange(products) {\n        var product = products && products.length === 1 ? products[0] : null;\n\n        if (product) {\n          _this2.onChangeField('product', product, productData._id);\n\n          _this2.changeCurrentProduct(product._id);\n        }\n      };\n\n      var content = function content(props) {\n        return React.createElement(ProductChooser, Object.assign({}, props, {\n          onSelect: productOnChange,\n          onChangeCategory: _this2.onChangeCategory,\n          categoryId: _this2.state.categoryId,\n          data: {\n            name: 'Product',\n            products: productData.product ? [productData.product] : []\n          },\n          limit: 1,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164\n          },\n          __self: this\n        }));\n      };\n\n      return React.createElement(ModalTrigger, {\n        title: \"Choose product & service\",\n        trigger: this.renderProductServiceTrigger(productData.product),\n        size: \"lg\",\n        content: content,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var productData = this.props.productData;\n      return React.createElement(ProductRow, {\n        key: productData._id,\n        onRemove: this.onClick,\n        activeProduct: this.state.currentProduct,\n        productData: productData,\n        changeCurrentProduct: this.changeCurrentProduct,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 417\n        },\n        __self: this\n      }, this.renderForm());\n    }\n  }]);\n\n  return ProductItem;\n}(React.Component);\n\nexport default ProductItem;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/deals/components/product/ProductItem.tsx"],"names":["FormControl","Icon","ModalTrigger","CURRENCIES","__","MEASUREMENTS","SelectTeamMembers","React","Select","ProductChooser","Amount","ContentColumn","ContentRow","ItemRow","ItemText","Measure","ProductButton","ProductItemContainer","ProductSettings","selectConfigOptions","ProductRow","ProductItem","props","componentDidMount","uom","currencies","productData","length","onChangeField","_id","currency","tempAssignee","localStorage","getItem","assignUserId","product","calculateAmount","type","amount","unitPrice","quantity","discountPercent","discount","tax","taxPercent","updateTotal","onChangeCategory","categoryId","setState","value","productId","productsData","onChangeProductsData","find","p","uomOnChange","option","currencyOnChange","onChange","e","target","name","onClick","removeProductItem","onTickUse","isChecked","currentTarget","checked","assignUserOnChange","userId","setItem","changeCurrentProduct","currentProduct","state","renderForm","selectOption","label","tickUsed","renderProductModal","toLocaleString","content","productOnChange","products","renderProductServiceTrigger","Component"],"mappings":"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","sourcesContent":["import FormControl from 'modules/common/components/form/Control';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport ModalTrigger from 'modules/common/components/ModalTrigger';\nimport CURRENCIES from 'modules/common/constants/currencies';\nimport { __ } from 'modules/common/utils';\nimport { MEASUREMENTS } from 'modules/settings/general/constants';\nimport { IProduct } from 'modules/settings/productService/types';\nimport SelectTeamMembers from 'modules/settings/team/containers/SelectTeamMembers';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport ProductChooser from '../../containers/product/ProductChooser';\nimport {\n  Amount,\n  ContentColumn,\n  ContentRow,\n  ItemRow,\n  ItemText,\n  Measure,\n  ProductButton,\n  ProductItemContainer,\n  ProductSettings\n} from '../../styles';\nimport { IProductData } from '../../types';\nimport { selectConfigOptions } from '../../utils';\nimport ProductRow from './ProductRow';\n\ntype Props = {\n  uom: string[];\n  currencies: string[];\n  productsData?: IProductData[];\n  productData: IProductData;\n  removeProductItem?: (productId: string) => void;\n  onChangeProductsData?: (productsData: IProductData[]) => void;\n  updateTotal?: () => void;\n  currentProduct?: string;\n};\n\ntype State = {\n  categoryId: string;\n  currentProduct: string;\n};\n\nclass ProductItem extends React.Component<Props, State> {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      categoryId: '',\n      currentProduct: props.currentProduct\n    };\n  }\n\n  componentDidMount = () => {\n    // default select item\n    const { uom, currencies, productData } = this.props;\n\n    if (uom.length > 0 && !productData.uom) {\n      this.onChangeField('uom', uom[0], productData._id);\n    }\n\n    if (currencies.length > 0 && !productData.currency) {\n      this.onChangeField('currency', currencies[0], productData._id);\n    }\n\n    // select previous assignee when add new product\n    const tempAssignee = localStorage.getItem('temporaryAssignee');\n    if (!productData.assignUserId && tempAssignee && !productData.product) {\n      this.onChangeField('assignUserId', tempAssignee, productData._id);\n    }\n  };\n\n  calculateAmount = (type: string, productData: IProductData) => {\n    const amount = productData.unitPrice * productData.quantity;\n\n    if (amount > 0) {\n      if (type === 'discount') {\n        productData.discountPercent = (productData.discount * 100) / amount;\n      } else {\n        productData.discount = (amount * productData.discountPercent) / 100;\n      }\n\n      productData.tax =\n        ((amount - productData.discount || 0) * productData.taxPercent) / 100;\n      productData.amount =\n        amount - (productData.discount || 0) + (productData.tax || 0);\n    } else {\n      productData.tax = 0;\n      productData.discount = 0;\n      productData.amount = 0;\n    }\n\n    const { updateTotal } = this.props;\n\n    if (updateTotal) {\n      updateTotal();\n    }\n  };\n\n  onChangeCategory = (categoryId: string) => {\n    this.setState({ categoryId });\n  };\n\n  onChangeField = (\n    type: string,\n    value: string | boolean | IProduct,\n    productId: string\n  ) => {\n    const { productsData, onChangeProductsData } = this.props;\n\n    if (productsData) {\n      const productData = productsData.find(p => p._id === productId);\n      if (productData) {\n        if (type === 'product') {\n          const product = value as IProduct;\n\n          productData.unitPrice = product.unitPrice;\n          productData.currency =\n            productData.currency || this.props.currencies[0];\n        }\n\n        productData[type] = value;\n      }\n\n      if (type !== 'uom' && productData) {\n        this.calculateAmount(type, productData);\n      }\n\n      if (onChangeProductsData) {\n        onChangeProductsData(productsData);\n      }\n    }\n  };\n\n  renderProductServiceTrigger(product?: IProduct) {\n    let content = (\n      <div>\n        {__('Choose Product & Service')} <Icon icon=\"plus-circle\" />\n      </div>\n    );\n\n    // if product selected\n    if (product) {\n      content = (\n        <div>\n          {product.name} <Icon icon=\"pen-1\" />\n        </div>\n      );\n    }\n\n    return <ProductButton>{content}</ProductButton>;\n  }\n\n  renderProductModal(productData: IProductData) {\n    const productOnChange = (products: IProduct[]) => {\n      const product = products && products.length === 1 ? products[0] : null;\n\n      if (product) {\n        this.onChangeField('product', product, productData._id);\n        this.changeCurrentProduct(product._id);\n      }\n    };\n\n    const content = props => (\n      <ProductChooser\n        {...props}\n        onSelect={productOnChange}\n        onChangeCategory={this.onChangeCategory}\n        categoryId={this.state.categoryId}\n        data={{\n          name: 'Product',\n          products: productData.product ? [productData.product] : []\n        }}\n        limit={1}\n      />\n    );\n\n    return (\n      <ModalTrigger\n        title=\"Choose product & service\"\n        trigger={this.renderProductServiceTrigger(productData.product)}\n        size=\"lg\"\n        content={content}\n      />\n    );\n  }\n\n  uomOnChange = (option: HTMLOptionElement) =>\n    this.onChangeField(\n      'uom',\n      option ? option.value : '',\n      this.props.productData._id\n    );\n\n  currencyOnChange = (currency: HTMLOptionElement) =>\n    this.onChangeField(\n      'currency',\n      currency ? currency.value : '',\n      this.props.productData._id\n    );\n\n  onChange = e =>\n    this.onChangeField(\n      (e.target as HTMLInputElement).name,\n      (e.target as HTMLInputElement).value,\n      this.props.productData._id\n    );\n\n  onClick = () => {\n    const { productData, removeProductItem } = this.props;\n\n    return removeProductItem && removeProductItem(productData._id);\n  };\n\n  onTickUse = e => {\n    const isChecked = (e.currentTarget as HTMLInputElement).checked;\n\n    this.onChangeField('tickUsed', isChecked, this.props.productData._id);\n  };\n\n  assignUserOnChange = userId => {\n    localStorage.setItem('temporaryAssignee', userId);\n    this.onChangeField('assignUserId', userId, this.props.productData._id);\n  };\n\n  changeCurrentProduct = (productId: string) => {\n    this.setState({\n      currentProduct: this.state.currentProduct === productId ? '' : productId\n    });\n  };\n\n  renderForm = () => {\n    const { productData, uom, currencies } = this.props;\n    const selectOption = option => (\n      <div className=\"simple-option\">\n        <span>{option.label}</span>\n      </div>\n    );\n\n    if (\n      !productData.product ||\n      this.state.currentProduct === productData.product._id\n    ) {\n      return (\n        <ProductItemContainer key={productData._id}>\n          <ContentRow>\n            <ProductSettings>\n              <ItemRow>\n                <ItemText>{__('Tick paid or used')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <FormControl\n                    componentClass=\"checkbox\"\n                    checked={productData.tickUsed}\n                    onChange={this.onTickUse}\n                  />\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('UOM')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <Select\n                    name=\"uom\"\n                    placeholder={__('Choose')}\n                    value={productData.uom}\n                    onChange={this.uomOnChange}\n                    optionRenderer={selectOption}\n                    options={selectConfigOptions(uom, MEASUREMENTS)}\n                  />\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Currency')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <Select\n                    name=\"currency\"\n                    placeholder={__('Choose')}\n                    value={productData.currency}\n                    onChange={this.currencyOnChange}\n                    optionRenderer={selectOption}\n                    options={selectConfigOptions(currencies, CURRENCIES)}\n                  />\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Assigned to')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <SelectTeamMembers\n                    label=\"Choose assigned user\"\n                    name=\"assignedUserId\"\n                    multi={false}\n                    customOption={{\n                      value: '',\n                      label: '-----------'\n                    }}\n                    value={productData.assignUserId}\n                    onSelect={this.assignUserOnChange}\n                  />\n                </ContentColumn>\n              </ItemRow>\n            </ProductSettings>\n            <ContentColumn>\n              <ItemRow>\n                <ItemText>{__('Choose Product')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  {this.renderProductModal(productData)}\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Quantity')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <FormControl\n                    defaultValue={productData.quantity || 0}\n                    type=\"number\"\n                    min={1}\n                    placeholder=\"0\"\n                    name=\"quantity\"\n                    onChange={this.onChange}\n                  />\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Unit price')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <FormControl\n                    value={productData.unitPrice || ''}\n                    type=\"number\"\n                    placeholder=\"0\"\n                    name=\"unitPrice\"\n                    onChange={this.onChange}\n                  />\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Amount')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <Amount>\n                    {(\n                      productData.quantity * productData.unitPrice\n                    ).toLocaleString()}{' '}\n                    <b>{productData.currency}</b>\n                  </Amount>\n                </ContentColumn>\n              </ItemRow>\n              <ItemRow>\n                <ItemText>{__('Discount')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <ContentRow>\n                    <ContentColumn>\n                      <ContentRow>\n                        <FormControl\n                          value={productData.discountPercent || ''}\n                          type=\"number\"\n                          min={0}\n                          max={100}\n                          placeholder=\"0\"\n                          name=\"discountPercent\"\n                          onChange={this.onChange}\n                        />\n                        <Measure>%</Measure>\n                      </ContentRow>\n                    </ContentColumn>\n                    <ContentColumn flex=\"2\">\n                      <ContentRow>\n                        <FormControl\n                          value={productData.discount || ''}\n                          type=\"number\"\n                          placeholder=\"0\"\n                          name=\"discount\"\n                          onChange={this.onChange}\n                        />\n                        <Measure>{productData.currency}</Measure>\n                      </ContentRow>\n                    </ContentColumn>\n                  </ContentRow>\n                </ContentColumn>\n              </ItemRow>\n\n              <ItemRow>\n                <ItemText>{__('Tax')}:</ItemText>\n                <ContentColumn flex=\"3\">\n                  <ContentRow>\n                    <ContentColumn>\n                      <ContentRow>\n                        <FormControl\n                          defaultValue={productData.taxPercent || ''}\n                          type=\"number\"\n                          min={0}\n                          max={100}\n                          placeholder=\"0\"\n                          name=\"taxPercent\"\n                          onChange={this.onChange}\n                        />\n                        <Measure>%</Measure>\n                      </ContentRow>\n                    </ContentColumn>\n                    <ContentColumn flex=\"2\">\n                      <Amount>\n                        {(productData.tax || 0).toLocaleString()}{' '}\n                        <b>{productData.currency}</b>\n                      </Amount>\n                    </ContentColumn>\n                  </ContentRow>\n                </ContentColumn>\n              </ItemRow>\n            </ContentColumn>\n          </ContentRow>\n        </ProductItemContainer>\n      );\n    }\n\n    return null;\n  };\n\n  render() {\n    const { productData } = this.props;\n\n    return (\n      <ProductRow\n        key={productData._id}\n        onRemove={this.onClick}\n        activeProduct={this.state.currentProduct}\n        productData={productData}\n        changeCurrentProduct={this.changeCurrentProduct}\n      >\n        {this.renderForm()}\n      </ProductRow>\n    );\n  }\n}\n\nexport default ProductItem;\n"]},"metadata":{},"sourceType":"module"}