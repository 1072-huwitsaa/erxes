{"ast":null,"code":"import _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/deals/components/product/ProductForm.tsx\";\nimport Button from 'modules/common/components/Button';\nimport EmptyState from 'modules/common/components/EmptyState';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport Table from 'modules/common/components/table';\nimport { Tabs, TabTitle } from 'modules/common/components/tabs';\nimport { ModalFooter } from 'modules/common/styles/main';\nimport { __, Alert } from 'modules/common/utils';\nimport React from 'react';\nimport { Add, FooterInfo, FormContainer, ProductTableWrapper } from '../../styles';\nimport PaymentForm from './PaymentForm';\nimport ProductItem from './ProductItem';\nimport ProductTotal from './ProductTotal';\n\nvar ProductForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ProductForm, _React$Component);\n\n  function ProductForm(props) {\n    var _this;\n\n    _classCallCheck(this, ProductForm);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ProductForm).call(this, props));\n\n    _this.addProductItem = function () {\n      var _this$props = _this.props,\n          productsData = _this$props.productsData,\n          onChangeProductsData = _this$props.onChangeProductsData,\n          currencies = _this$props.currencies;\n      var _this$state = _this.state,\n          tax = _this$state.tax,\n          discount = _this$state.discount;\n      var currency = currencies ? currencies[0] : '';\n\n      _this.setState({\n        tempId: Math.random().toString()\n      }, function () {\n        productsData.push({\n          _id: _this.state.tempId,\n          quantity: 1,\n          unitPrice: 0,\n          tax: 0,\n          taxPercent: tax[currency] ? tax[currency].percent || 0 : 0,\n          discount: 0,\n          discountPercent: discount[currency] ? discount[currency].percent || 0 : 0,\n          amount: 0,\n          currency: currency,\n          tickUsed: true\n        });\n        onChangeProductsData(productsData);\n      });\n    };\n\n    _this.removeProductItem = function (productId) {\n      var _this$props2 = _this.props,\n          productsData = _this$props2.productsData,\n          onChangeProductsData = _this$props2.onChangeProductsData;\n      var removedProductsData = productsData.filter(function (p) {\n        return p._id !== productId;\n      });\n      onChangeProductsData(removedProductsData);\n\n      _this.updateTotal(removedProductsData);\n    };\n\n    _this.updateTotal = function () {\n      var productsData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.props.productsData;\n      var total = {};\n      var tax = {};\n      var discount = {};\n      productsData.forEach(function (p) {\n        if (p.currency && p.tickUsed) {\n          if (!total[p.currency]) {\n            discount[p.currency] = {\n              percent: 0,\n              value: 0\n            };\n            tax[p.currency] = {\n              percent: 0,\n              value: 0\n            };\n            total[p.currency] = 0;\n          }\n\n          discount[p.currency].value += p.discount || 0;\n          tax[p.currency].value += p.tax || 0;\n          total[p.currency] += p.amount || 0;\n        }\n      });\n\n      for (var _i = 0, _Object$keys = Object.keys(discount); _i < _Object$keys.length; _i++) {\n        var _currency = _Object$keys[_i];\n        var clearTotal = total[_currency] - tax[_currency].value;\n        tax[_currency].percent = tax[_currency].value * 100 / clearTotal;\n        clearTotal = clearTotal + discount[_currency].value;\n        discount[_currency].percent = discount[_currency].value * 100 / clearTotal;\n      }\n\n      _this.setState({\n        total: total,\n        tax: tax,\n        discount: discount\n      });\n    };\n\n    _this.calcChangePay = function () {\n      var paymentsData = _this.props.paymentsData;\n      var total = _this.state.total;\n      var changePayData = Object.assign({}, total);\n      var payments = paymentsData || {};\n      Object.keys(payments || {}).forEach(function (key) {\n        var perPaid = payments[key];\n        var currency = perPaid.currency || '';\n\n        if (Object.keys(changePayData).includes(currency)) {\n          changePayData[currency] = changePayData[currency] - (perPaid.amount || 0);\n        } else {\n          if (perPaid.currency && perPaid.amount) {\n            changePayData[currency] = -(perPaid.amount || 0);\n          }\n        }\n      });\n\n      _this.setState({\n        changePayData: changePayData\n      });\n    };\n\n    _this.onClick = function () {\n      var _this$props3 = _this.props,\n          saveProductsData = _this$props3.saveProductsData,\n          productsData = _this$props3.productsData,\n          closeModal = _this$props3.closeModal;\n      var _this$state2 = _this.state,\n          total = _this$state2.total,\n          changePayData = _this$state2.changePayData;\n\n      if (productsData.length !== 0) {\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = productsData[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var data = _step.value;\n\n            if (!data.product) {\n              return Alert.error('Please choose a product');\n            }\n\n            if (!data.unitPrice && data.unitPrice !== 0) {\n              return Alert.error('Please enter an unit price. It should be a number');\n            }\n\n            if (!data.currency) {\n              return Alert.error('Please choose a currency');\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n\n      if (Object.keys(total).length > 0 && Object.keys(changePayData).length > 0) {\n        var alertMsg = '';\n\n        for (var _i2 = 0, _Object$keys2 = Object.keys(changePayData); _i2 < _Object$keys2.length; _i2++) {\n          var key = _Object$keys2[_i2];\n\n          // warning greater pay\n          if (changePayData[key] > 0) {\n            alertMsg = alertMsg + \"Greater than total: \".concat(changePayData[key], \" \").concat(key, \",\");\n          } // warning less pay\n\n\n          if (changePayData[key] < 0) {\n            alertMsg = alertMsg + \"Less than total: \".concat(changePayData[key], \" \").concat(key, \",\");\n          }\n        }\n\n        if (alertMsg) {\n          Alert.warning('Change payment has problem: (' + alertMsg + ')');\n        }\n      }\n\n      saveProductsData();\n      closeModal();\n    };\n\n    _this.onTabClick = function (currentTab) {\n      _this.setState({\n        currentTab: currentTab\n      });\n    };\n\n    _this.state = {\n      total: {},\n      discount: {},\n      tax: {},\n      currentTab: 'products',\n      changePayData: {},\n      tempId: ''\n    };\n    return _this;\n  }\n\n  _createClass(ProductForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.updateTotal(); // initial product item\n\n      if (this.props.productsData.length === 0) {\n        this.addProductItem();\n      }\n    }\n  }, {\n    key: \"renderTotal\",\n    value: function renderTotal(totalKind, kindTxt) {\n      var _this2 = this;\n\n      var _this$props4 = this.props,\n          productsData = _this$props4.productsData,\n          onChangeProductsData = _this$props4.onChangeProductsData;\n      return Object.keys(totalKind).map(function (currency) {\n        return React.createElement(ProductTotal, {\n          key: kindTxt.concat(currency),\n          totalKind: totalKind[currency],\n          kindTxt: kindTxt,\n          currency: currency,\n          productsData: productsData,\n          updateTotal: _this2.updateTotal,\n          onChangeProductsData: onChangeProductsData,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136\n          },\n          __self: this\n        });\n      });\n    }\n  }, {\n    key: \"renderContent\",\n    value: function renderContent() {\n      var _this3 = this;\n\n      var _this$props5 = this.props,\n          productsData = _this$props5.productsData,\n          onChangeProductsData = _this$props5.onChangeProductsData,\n          currentProduct = _this$props5.currentProduct;\n\n      if (productsData.length === 0) {\n        return React.createElement(EmptyState, {\n          size: \"full\",\n          text: \"No product or services\",\n          icon: \"box\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 153\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(ProductTableWrapper, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(Table, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, __('Product / Service')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, __('Quantity')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, __('Unit price')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, __('Discount')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }, __('Tax')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, __('Amount')), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }))), React.createElement(\"tbody\", {\n        id: \"products\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, productsData.map(function (productData) {\n        return React.createElement(ProductItem, {\n          key: productData._id,\n          productData: productData,\n          removeProductItem: _this3.removeProductItem,\n          productsData: productsData,\n          onChangeProductsData: onChangeProductsData,\n          updateTotal: _this3.updateTotal,\n          uom: _this3.props.uom,\n          currencies: _this3.props.currencies,\n          currentProduct: currentProduct,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        });\n      }))));\n    }\n  }, {\n    key: \"renderTabContent\",\n    value: function renderTabContent() {\n      var _this$state3 = this.state,\n          total = _this$state3.total,\n          tax = _this$state3.tax,\n          discount = _this$state3.discount,\n          currentTab = _this$state3.currentTab;\n\n      if (currentTab === 'payments') {\n        var onChangePaymentsData = this.props.onChangePaymentsData;\n        return React.createElement(PaymentForm, {\n          total: total,\n          payments: this.props.paymentsData,\n          onChangePaymentsData: onChangePaymentsData,\n          currencies: this.props.currencies,\n          calcChangePay: this.calcChangePay,\n          changePayData: this.state.changePayData,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(FormContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, this.renderContent(), React.createElement(Add, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      }, React.createElement(Button, {\n        uppercase: false,\n        btnStyle: \"primary\",\n        onClick: this.addProductItem,\n        icon: \"plus-circle\",\n        href: \"#\".concat(this.state.tempId),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288\n        },\n        __self: this\n      }, \"Add Product / Service\")), React.createElement(FooterInfo, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      }, React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302\n        },\n        __self: this\n      }, __('Discount'), \":\"), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303\n        },\n        __self: this\n      }, this.renderTotal(discount, 'discount'))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }, __('Tax'), \":\"), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }, this.renderTotal(tax, 'tax'))), React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }, __('Total'), \":\"), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311\n        },\n        __self: this\n      }, this.renderTotal(total, 'total')))))));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var currentTab = this.state.currentTab;\n      return React.createElement(React.Fragment, null, React.createElement(Tabs, {\n        grayBorder: true,\n        full: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328\n        },\n        __self: this\n      }, React.createElement(TabTitle, {\n        className: currentTab === 'products' ? 'active' : '',\n        onClick: this.onTabClick.bind(this, 'products'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        icon: \"box\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333\n        },\n        __self: this\n      }), __('Products')), React.createElement(TabTitle, {\n        className: currentTab === 'payments' ? 'active' : '',\n        onClick: this.onTabClick.bind(this, 'payments'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 336\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        icon: \"atm-card\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340\n        },\n        __self: this\n      }), __('Payments'))), this.renderTabContent(), React.createElement(ModalFooter, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347\n        },\n        __self: this\n      }, React.createElement(Button, {\n        btnStyle: \"simple\",\n        onClick: this.props.closeModal,\n        icon: \"times-circle\",\n        uppercase: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 348\n        },\n        __self: this\n      }, \"Cancel\"), React.createElement(Button, {\n        btnStyle: \"success\",\n        onClick: this.onClick,\n        icon: \"check-circle\",\n        uppercase: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 357\n        },\n        __self: this\n      }, \"Save\")));\n    }\n  }]);\n\n  return ProductForm;\n}(React.Component);\n\nexport default ProductForm;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/deals/components/product/ProductForm.tsx"],"names":["Button","EmptyState","Icon","Table","Tabs","TabTitle","ModalFooter","__","Alert","React","Add","FooterInfo","FormContainer","ProductTableWrapper","PaymentForm","ProductItem","ProductTotal","ProductForm","props","addProductItem","productsData","onChangeProductsData","currencies","state","tax","discount","currency","setState","tempId","Math","random","toString","push","_id","quantity","unitPrice","taxPercent","percent","discountPercent","amount","tickUsed","removeProductItem","productId","removedProductsData","filter","p","updateTotal","total","forEach","value","Object","keys","clearTotal","calcChangePay","paymentsData","changePayData","assign","payments","key","perPaid","includes","onClick","saveProductsData","closeModal","length","data","product","error","alertMsg","warning","onTabClick","currentTab","totalKind","kindTxt","map","concat","currentProduct","productData","uom","onChangePaymentsData","renderContent","renderTotal","bind","renderTabContent","Component"],"mappings":"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","sourcesContent":["import Button from 'modules/common/components/Button';\nimport EmptyState from 'modules/common/components/EmptyState';\nimport Icon from 'erxes-common-ui/lib/components/icon';\nimport Table from 'modules/common/components/table';\nimport { Tabs, TabTitle } from 'modules/common/components/tabs';\nimport { ModalFooter } from 'modules/common/styles/main';\nimport { __, Alert } from 'modules/common/utils';\nimport { IProduct } from 'modules/settings/productService/types';\nimport React from 'react';\nimport {\n  Add,\n  FooterInfo,\n  FormContainer,\n  ProductTableWrapper\n} from '../../styles';\nimport { IPaymentsData, IProductData } from '../../types';\nimport PaymentForm from './PaymentForm';\nimport ProductItem from './ProductItem';\nimport ProductTotal from './ProductTotal';\n\ntype Props = {\n  onChangeProductsData: (productsData: IProductData[]) => void;\n  saveProductsData: () => void;\n  onChangePaymentsData: (paymentsData: IPaymentsData) => void;\n  productsData: IProductData[];\n  products: IProduct[];\n  paymentsData?: IPaymentsData;\n  closeModal: () => void;\n  uom: string[];\n  currencies: string[];\n  currentProduct?: string;\n};\n\ntype State = {\n  total: { [currency: string]: number };\n  tax: { [currency: string]: { value?: number; percent?: number } };\n  discount: { [currency: string]: { value?: number; percent?: number } };\n  currentTab: string;\n  changePayData: { [currency: string]: number };\n  tempId: string;\n};\n\nclass ProductForm extends React.Component<Props, State> {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      total: {},\n      discount: {},\n      tax: {},\n      currentTab: 'products',\n      changePayData: {},\n      tempId: ''\n    };\n  }\n\n  componentDidMount() {\n    this.updateTotal();\n\n    // initial product item\n    if (this.props.productsData.length === 0) {\n      this.addProductItem();\n    }\n  }\n\n  addProductItem = () => {\n    const { productsData, onChangeProductsData, currencies } = this.props;\n    const { tax, discount } = this.state;\n\n    const currency = currencies ? currencies[0] : '';\n\n    this.setState({ tempId: Math.random().toString() }, () => {\n      productsData.push({\n        _id: this.state.tempId,\n        quantity: 1,\n        unitPrice: 0,\n        tax: 0,\n        taxPercent: tax[currency] ? tax[currency].percent || 0 : 0,\n        discount: 0,\n        discountPercent: discount[currency]\n          ? discount[currency].percent || 0\n          : 0,\n        amount: 0,\n        currency,\n        tickUsed: true\n      });\n\n      onChangeProductsData(productsData);\n    });\n  };\n\n  removeProductItem = productId => {\n    const { productsData, onChangeProductsData } = this.props;\n\n    const removedProductsData = productsData.filter(p => p._id !== productId);\n\n    onChangeProductsData(removedProductsData);\n\n    this.updateTotal(removedProductsData);\n  };\n\n  updateTotal = (productsData = this.props.productsData) => {\n    const total = {};\n    const tax = {};\n    const discount = {};\n\n    productsData.forEach(p => {\n      if (p.currency && p.tickUsed) {\n        if (!total[p.currency]) {\n          discount[p.currency] = { percent: 0, value: 0 };\n          tax[p.currency] = { percent: 0, value: 0 };\n          total[p.currency] = 0;\n        }\n\n        discount[p.currency].value += p.discount || 0;\n        tax[p.currency].value += p.tax || 0;\n        total[p.currency] += p.amount || 0;\n      }\n    });\n\n    for (const currency of Object.keys(discount)) {\n      let clearTotal = total[currency] - tax[currency].value;\n      tax[currency].percent = (tax[currency].value * 100) / clearTotal;\n\n      clearTotal = clearTotal + discount[currency].value;\n      discount[currency].percent =\n        (discount[currency].value * 100) / clearTotal;\n    }\n\n    this.setState({ total, tax, discount });\n  };\n\n  renderTotal(totalKind, kindTxt) {\n    const { productsData, onChangeProductsData } = this.props;\n    return Object.keys(totalKind).map(currency => (\n      <ProductTotal\n        key={kindTxt.concat(currency)}\n        totalKind={totalKind[currency]}\n        kindTxt={kindTxt}\n        currency={currency}\n        productsData={productsData}\n        updateTotal={this.updateTotal}\n        onChangeProductsData={onChangeProductsData}\n      />\n    ));\n  }\n\n  renderContent() {\n    const { productsData, onChangeProductsData, currentProduct } = this.props;\n\n    if (productsData.length === 0) {\n      return (\n        <EmptyState size=\"full\" text=\"No product or services\" icon=\"box\" />\n      );\n    }\n\n    return (\n      <ProductTableWrapper>\n        <Table>\n          <thead>\n            <tr>\n              <th>{__('Product / Service')}</th>\n              <th>{__('Quantity')}</th>\n              <th>{__('Unit price')}</th>\n              <th>{__('Discount')}</th>\n              <th>{__('Tax')}</th>\n              <th>{__('Amount')}</th>\n              <th />\n            </tr>\n          </thead>\n          <tbody id=\"products\">\n            {productsData.map(productData => (\n              <ProductItem\n                key={productData._id}\n                productData={productData}\n                removeProductItem={this.removeProductItem}\n                productsData={productsData}\n                onChangeProductsData={onChangeProductsData}\n                updateTotal={this.updateTotal}\n                uom={this.props.uom}\n                currencies={this.props.currencies}\n                currentProduct={currentProduct}\n              />\n            ))}\n          </tbody>\n        </Table>\n      </ProductTableWrapper>\n    );\n  }\n\n  calcChangePay = () => {\n    const { paymentsData } = this.props;\n    const { total } = this.state;\n\n    const changePayData = Object.assign({}, total);\n    const payments = paymentsData || {};\n\n    Object.keys(payments || {}).forEach(key => {\n      const perPaid = payments[key];\n      const currency = perPaid.currency || '';\n\n      if (Object.keys(changePayData).includes(currency)) {\n        changePayData[currency] =\n          changePayData[currency] - (perPaid.amount || 0);\n      } else {\n        if (perPaid.currency && perPaid.amount) {\n          changePayData[currency] = -(perPaid.amount || 0);\n        }\n      }\n    });\n\n    this.setState({ changePayData });\n  };\n\n  onClick = () => {\n    const { saveProductsData, productsData, closeModal } = this.props;\n\n    const { total, changePayData } = this.state;\n\n    if (productsData.length !== 0) {\n      for (const data of productsData) {\n        if (!data.product) {\n          return Alert.error('Please choose a product');\n        }\n\n        if (!data.unitPrice && data.unitPrice !== 0) {\n          return Alert.error(\n            'Please enter an unit price. It should be a number'\n          );\n        }\n\n        if (!data.currency) {\n          return Alert.error('Please choose a currency');\n        }\n      }\n    }\n\n    if (\n      Object.keys(total).length > 0 &&\n      Object.keys(changePayData).length > 0\n    ) {\n      let alertMsg = '';\n      for (const key of Object.keys(changePayData)) {\n        // warning greater pay\n        if (changePayData[key] > 0) {\n          alertMsg =\n            alertMsg + `Greater than total: ${changePayData[key]} ${key},`;\n        }\n\n        // warning less pay\n        if (changePayData[key] < 0) {\n          alertMsg =\n            alertMsg + `Less than total: ${changePayData[key]} ${key},`;\n        }\n      }\n\n      if (alertMsg) {\n        Alert.warning('Change payment has problem: (' + alertMsg + ')');\n      }\n    }\n\n    saveProductsData();\n    closeModal();\n  };\n\n  renderTabContent() {\n    const { total, tax, discount, currentTab } = this.state;\n\n    if (currentTab === 'payments') {\n      const { onChangePaymentsData } = this.props;\n\n      return (\n        <PaymentForm\n          total={total}\n          payments={this.props.paymentsData}\n          onChangePaymentsData={onChangePaymentsData}\n          currencies={this.props.currencies}\n          calcChangePay={this.calcChangePay}\n          changePayData={this.state.changePayData}\n        />\n      );\n    }\n\n    return (\n      <FormContainer>\n        {this.renderContent()}\n        <Add>\n          <Button\n            uppercase={false}\n            btnStyle=\"primary\"\n            onClick={this.addProductItem}\n            icon=\"plus-circle\"\n            href={`#${this.state.tempId}`}\n          >\n            Add Product / Service\n          </Button>\n        </Add>\n        <FooterInfo>\n          <table>\n            <tbody>\n              <tr>\n                <td>{__('Discount')}:</td>\n                <td>{this.renderTotal(discount, 'discount')}</td>\n              </tr>\n              <tr>\n                <td>{__('Tax')}:</td>\n                <td>{this.renderTotal(tax, 'tax')}</td>\n              </tr>\n              <tr>\n                <td>{__('Total')}:</td>\n                <td>{this.renderTotal(total, 'total')}</td>\n              </tr>\n            </tbody>\n          </table>\n        </FooterInfo>\n      </FormContainer>\n    );\n  }\n\n  onTabClick = (currentTab: string) => {\n    this.setState({ currentTab });\n  };\n\n  render() {\n    const { currentTab } = this.state;\n    return (\n      <>\n        <Tabs grayBorder={true} full={true}>\n          <TabTitle\n            className={currentTab === 'products' ? 'active' : ''}\n            onClick={this.onTabClick.bind(this, 'products')}\n          >\n            <Icon icon=\"box\" />\n            {__('Products')}\n          </TabTitle>\n          <TabTitle\n            className={currentTab === 'payments' ? 'active' : ''}\n            onClick={this.onTabClick.bind(this, 'payments')}\n          >\n            <Icon icon=\"atm-card\" />\n            {__('Payments')}\n          </TabTitle>\n        </Tabs>\n\n        {this.renderTabContent()}\n\n        <ModalFooter>\n          <Button\n            btnStyle=\"simple\"\n            onClick={this.props.closeModal}\n            icon=\"times-circle\"\n            uppercase={false}\n          >\n            Cancel\n          </Button>\n\n          <Button\n            btnStyle=\"success\"\n            onClick={this.onClick}\n            icon=\"check-circle\"\n            uppercase={false}\n          >\n            Save\n          </Button>\n        </ModalFooter>\n      </>\n    );\n  }\n}\n\nexport default ProductForm;\n"]},"metadata":{},"sourceType":"module"}