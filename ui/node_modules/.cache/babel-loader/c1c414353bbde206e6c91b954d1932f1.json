{"ast":null,"code":"import _defineProperty from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/anu-ujin/Works/open-source/erxes/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/webhook/components/WebhookForm.tsx\";\nimport FormControl from 'modules/common/components/form/Control';\nimport FormGroup from 'modules/common/components/form/Group';\nimport ControlLabel from 'modules/common/components/form/Label';\nimport { __, Alert } from 'modules/common/utils';\nimport { WEBHOOK_ACTIONS } from 'modules/settings/constants';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport CommonForm from '../../common/components/Form';\n\nvar WebhookForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(WebhookForm, _React$Component);\n\n  function WebhookForm(props) {\n    var _this;\n\n    _classCallCheck(this, WebhookForm);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(WebhookForm).call(this, props));\n\n    _this.select = function (name, value) {\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.onChange = function (e) {\n      var index = e.currentTarget.value;\n      var isChecked = e.currentTarget.checked;\n      var selected = _this.state.selectedActions[index];\n      var selectedActions = _this.state.selectedActions;\n      selectedActions[index] = {\n        type: selected.type,\n        action: selected.action,\n        label: selected.label,\n        checked: isChecked\n      };\n\n      _this.setState({\n        selectedActions: selectedActions\n      });\n    };\n\n    _this.collectValues = function (selectedActions) {\n      return selectedActions.map(function (selectedAction) {\n        return WEBHOOK_ACTIONS.find(function (action) {\n          return action.label === selectedAction.label;\n        }) || {};\n      });\n    };\n\n    _this.generateDoc = function (values) {\n      var object = _this.props.object;\n      var selectedActions = _this.state.selectedActions;\n      var finalValues = values;\n\n      if (!selectedActions) {\n        return Alert.error('Choose action!');\n      }\n\n      if (object) {\n        finalValues._id = object._id;\n      }\n\n      return {\n        _id: finalValues._id,\n        url: finalValues.url,\n        actions: _this.collectValues(selectedActions)\n      };\n    };\n\n    _this.generateActions = function () {\n      return WEBHOOK_ACTIONS.map(function (action) {\n        return {\n          label: action.label,\n          value: action.label\n        };\n      });\n    };\n\n    _this.renderContent = function (formProps) {\n      var object = _this.props.object || {};\n      var selectedActions = _this.state.selectedActions;\n      return React.createElement(React.Fragment, null, React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }, React.createElement(ControlLabel, {\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }, \"Endpoint url\"), React.createElement(FormControl, Object.assign({}, formProps, {\n        name: \"url\",\n        defaultValue: object.url,\n        required: true,\n        autoFocus: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }))), React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, React.createElement(ControlLabel, {\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, \"Actions\"), React.createElement(Select, {\n        placeholder: __('Choose actions'),\n        options: _this.generateActions(),\n        value: selectedActions,\n        onChange: _this.select.bind(_assertThisInitialized(_this), 'selectedActions'),\n        multi: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      })));\n    };\n\n    var webhook = props.object || {};\n    var webhookActions = [];\n\n    if (webhook.actions) {\n      webhookActions = webhook.actions.map(function (item) {\n        return {\n          label: item.label,\n          value: item.label\n        };\n      }) || [];\n    }\n\n    var _selectedActions = webhookActions;\n    _this.state = {\n      selectedActions: _selectedActions\n    };\n    return _this;\n  }\n\n  _createClass(WebhookForm, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(CommonForm, Object.assign({}, this.props, {\n        name: \"Webhook\",\n        renderContent: this.renderContent,\n        generateDoc: this.generateDoc,\n        object: this.props.object,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return WebhookForm;\n}(React.Component);\n\nexport default WebhookForm;","map":{"version":3,"sources":["/home/anu-ujin/Works/open-source/erxes/ui/src/modules/settings/webhook/components/WebhookForm.tsx"],"names":["FormControl","FormGroup","ControlLabel","__","Alert","WEBHOOK_ACTIONS","React","Select","CommonForm","WebhookForm","props","select","name","value","setState","onChange","e","index","currentTarget","isChecked","checked","selected","state","selectedActions","type","action","label","collectValues","map","selectedAction","find","generateDoc","values","object","finalValues","error","_id","url","actions","generateActions","renderContent","formProps","bind","webhook","webhookActions","item","Component"],"mappings":";;;;;;;;AAAA,OAAOA,WAAP,MAAwB,wCAAxB;AACA,OAAOC,SAAP,MAAsB,sCAAtB;AACA,OAAOC,YAAP,MAAyB,sCAAzB;AAEA,SAASC,EAAT,EAAaC,KAAb,QAA0B,sBAA1B;AACA,SAASC,eAAT,QAAgC,4BAAhC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;;IAYMC,W;;;;;AACJ,uBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,qFAAMA,KAAN;;AADiB,UAqBnBC,MArBmB,GAqBV,UAAwBC,IAAxB,EAAiCC,KAAjC,EAA2C;AAClD,YAAKC,QAAL,qBAAiBF,IAAjB,EAAwBC,KAAxB;AACD,KAvBkB;;AAAA,UAyBnBE,QAzBmB,GAyBR,UAAAC,CAAC,EAAI;AACd,UAAMC,KAAK,GAAID,CAAC,CAACE,aAAH,CAAsCL,KAApD;AACA,UAAMM,SAAS,GAAIH,CAAC,CAACE,aAAH,CAAsCE,OAAxD;AAEA,UAAMC,QAAQ,GAAG,MAAKC,KAAL,CAAWC,eAAX,CAA2BN,KAA3B,CAAjB;AACA,UAAMM,eAAe,GAAG,MAAKD,KAAL,CAAWC,eAAnC;AAEAA,MAAAA,eAAe,CAACN,KAAD,CAAf,GAAyB;AACvBO,QAAAA,IAAI,EAAEH,QAAQ,CAACG,IADQ;AAEvBC,QAAAA,MAAM,EAAEJ,QAAQ,CAACI,MAFM;AAGvBC,QAAAA,KAAK,EAAEL,QAAQ,CAACK,KAHO;AAIvBN,QAAAA,OAAO,EAAED;AAJc,OAAzB;;AAOA,YAAKL,QAAL,CAAc;AAAES,QAAAA,eAAe,EAAfA;AAAF,OAAd;AACD,KAxCkB;;AAAA,UA0CnBI,aA1CmB,GA0CH,UAAAJ,eAAe;AAAA,aAC7BA,eAAe,CAACK,GAAhB,CACE,UAAAC,cAAc;AAAA,eACZxB,eAAe,CAACyB,IAAhB,CAAqB,UAAAL,MAAM;AAAA,iBAAIA,MAAM,CAACC,KAAP,KAAiBG,cAAc,CAACH,KAApC;AAAA,SAA3B,KACA,EAFY;AAAA,OADhB,CAD6B;AAAA,KA1CZ;;AAAA,UAiDnBK,WAjDmB,GAiDL,UAACC,MAAD,EAA2C;AAAA,UAC/CC,MAD+C,GACpC,MAAKvB,KAD+B,CAC/CuB,MAD+C;AAAA,UAE/CV,eAF+C,GAE3B,MAAKD,KAFsB,CAE/CC,eAF+C;AAGvD,UAAMW,WAAW,GAAGF,MAApB;;AAEA,UAAI,CAACT,eAAL,EAAsB;AACpB,eAAOnB,KAAK,CAAC+B,KAAN,CAAY,gBAAZ,CAAP;AACD;;AAED,UAAIF,MAAJ,EAAY;AACVC,QAAAA,WAAW,CAACE,GAAZ,GAAkBH,MAAM,CAACG,GAAzB;AACD;;AAED,aAAO;AACLA,QAAAA,GAAG,EAAEF,WAAW,CAACE,GADZ;AAELC,QAAAA,GAAG,EAAEH,WAAW,CAACG,GAFZ;AAGLC,QAAAA,OAAO,EAAE,MAAKX,aAAL,CAAmBJ,eAAnB;AAHJ,OAAP;AAKD,KAnEkB;;AAAA,UAqEnBgB,eArEmB,GAqED,YAAM;AACtB,aAAOlC,eAAe,CAACuB,GAAhB,CAAoB,UAAAH,MAAM,EAAI;AACnC,eAAO;AAAEC,UAAAA,KAAK,EAAED,MAAM,CAACC,KAAhB;AAAuBb,UAAAA,KAAK,EAAEY,MAAM,CAACC;AAArC,SAAP;AACD,OAFM,CAAP;AAGD,KAzEkB;;AAAA,UA2EnBc,aA3EmB,GA2EH,UAACC,SAAD,EAA2B;AACzC,UAAMR,MAAM,GAAG,MAAKvB,KAAL,CAAWuB,MAAX,IAAsB,EAArC;AADyC,UAEjCV,eAFiC,GAEb,MAAKD,KAFQ,CAEjCC,eAFiC;AAIzC,aACE,0CACE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,YAAD;AAAc,QAAA,QAAQ,EAAE,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,EAEE,oBAAC,WAAD,oBACMkB,SADN;AAEE,QAAA,IAAI,EAAC,KAFP;AAGE,QAAA,YAAY,EAAER,MAAM,CAACI,GAHvB;AAIE,QAAA,QAAQ,EAAE,IAJZ;AAKE,QAAA,SAAS,EAAE,IALb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAFF,CADF,EAYE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,YAAD;AAAc,QAAA,QAAQ,EAAE,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,EAEE,oBAAC,MAAD;AACE,QAAA,WAAW,EAAElC,EAAE,CAAC,gBAAD,CADjB;AAEE,QAAA,OAAO,EAAE,MAAKoC,eAAL,EAFX;AAGE,QAAA,KAAK,EAAEhB,eAHT;AAIE,QAAA,QAAQ,EAAE,MAAKZ,MAAL,CAAY+B,IAAZ,gCAAuB,iBAAvB,CAJZ;AAKE,QAAA,KAAK,EAAE,IALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF,CAZF,CADF;AAyBD,KAxGkB;;AAGjB,QAAMC,OAAO,GAAGjC,KAAK,CAACuB,MAAN,IAAgB,EAAhC;AAEA,QAAIW,cAAc,GAAG,EAArB;;AAEA,QAAID,OAAO,CAACL,OAAZ,EAAqB;AACnBM,MAAAA,cAAc,GACZD,OAAO,CAACL,OAAR,CAAgBV,GAAhB,CAAoB,UAAAiB,IAAI,EAAI;AAC1B,eAAO;AAAEnB,UAAAA,KAAK,EAAEmB,IAAI,CAACnB,KAAd;AAAqBb,UAAAA,KAAK,EAAEgC,IAAI,CAACnB;AAAjC,SAAP;AACD,OAFD,KAEM,EAHR;AAID;;AAED,QAAMH,gBAAe,GAAGqB,cAAxB;AAEA,UAAKtB,KAAL,GAAa;AACXC,MAAAA,eAAe,EAAfA;AADW,KAAb;AAhBiB;AAmBlB;;;;6BAuFQ;AACP,aACE,oBAAC,UAAD,oBACM,KAAKb,KADX;AAEE,QAAA,IAAI,EAAC,SAFP;AAGE,QAAA,aAAa,EAAE,KAAK8B,aAHtB;AAIE,QAAA,WAAW,EAAE,KAAKT,WAJpB;AAKE,QAAA,MAAM,EAAE,KAAKrB,KAAL,CAAWuB,MALrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADF;AASD;;;;EArHuB3B,KAAK,CAACwC,S;;AAwHhC,eAAerC,WAAf","sourcesContent":["import FormControl from 'modules/common/components/form/Control';\nimport FormGroup from 'modules/common/components/form/Group';\nimport ControlLabel from 'modules/common/components/form/Label';\nimport { IFormProps } from 'modules/common/types';\nimport { __, Alert } from 'modules/common/utils';\nimport { WEBHOOK_ACTIONS } from 'modules/settings/constants';\nimport React from 'react';\nimport Select from 'react-select-plus';\nimport CommonForm from '../../common/components/Form';\nimport { ICommonFormProps } from '../../common/types';\nimport { IWebhook } from '../types';\n\ntype Props = {\n  object?: IWebhook;\n};\n\ntype State = {\n  selectedActions: any[];\n};\n\nclass WebhookForm extends React.Component<Props & ICommonFormProps, State> {\n  constructor(props) {\n    super(props);\n\n    const webhook = props.object || {};\n\n    let webhookActions = [] as any;\n\n    if (webhook.actions) {\n      webhookActions =\n        webhook.actions.map(item => {\n          return { label: item.label, value: item.label };\n        }) || [];\n    }\n\n    const selectedActions = webhookActions;\n\n    this.state = {\n      selectedActions\n    };\n  }\n\n  select = <T extends keyof State>(name: T, value) => {\n    this.setState({ [name]: value } as Pick<State, keyof State>);\n  };\n\n  onChange = e => {\n    const index = (e.currentTarget as HTMLInputElement).value;\n    const isChecked = (e.currentTarget as HTMLInputElement).checked;\n\n    const selected = this.state.selectedActions[index];\n    const selectedActions = this.state.selectedActions;\n\n    selectedActions[index] = {\n      type: selected.type,\n      action: selected.action,\n      label: selected.label,\n      checked: isChecked\n    };\n\n    this.setState({ selectedActions });\n  };\n\n  collectValues = selectedActions =>\n    selectedActions.map(\n      selectedAction =>\n        WEBHOOK_ACTIONS.find(action => action.label === selectedAction.label) ||\n        {}\n    );\n\n  generateDoc = (values: { _id?: string; url: string }) => {\n    const { object } = this.props;\n    const { selectedActions } = this.state;\n    const finalValues = values;\n\n    if (!selectedActions) {\n      return Alert.error('Choose action!');\n    }\n\n    if (object) {\n      finalValues._id = object._id;\n    }\n\n    return {\n      _id: finalValues._id,\n      url: finalValues.url,\n      actions: this.collectValues(selectedActions)\n    };\n  };\n\n  generateActions = () => {\n    return WEBHOOK_ACTIONS.map(action => {\n      return { label: action.label, value: action.label };\n    });\n  };\n\n  renderContent = (formProps: IFormProps) => {\n    const object = this.props.object || ({} as IWebhook);\n    const { selectedActions } = this.state;\n\n    return (\n      <>\n        <FormGroup>\n          <ControlLabel required={true}>Endpoint url</ControlLabel>\n          <FormControl\n            {...formProps}\n            name=\"url\"\n            defaultValue={object.url}\n            required={true}\n            autoFocus={true}\n          />\n        </FormGroup>\n\n        <FormGroup>\n          <ControlLabel required={true}>Actions</ControlLabel>\n          <Select\n            placeholder={__('Choose actions')}\n            options={this.generateActions()}\n            value={selectedActions}\n            onChange={this.select.bind(this, 'selectedActions')}\n            multi={true}\n          />\n        </FormGroup>\n      </>\n    );\n  };\n\n  render() {\n    return (\n      <CommonForm\n        {...this.props}\n        name=\"Webhook\"\n        renderContent={this.renderContent}\n        generateDoc={this.generateDoc}\n        object={this.props.object}\n      />\n    );\n  }\n}\n\nexport default WebhookForm;\n"]},"metadata":{},"sourceType":"module"}