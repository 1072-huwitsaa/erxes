(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9939],{3905:function(e,n,r){"use strict";r.d(n,{Zo:function(){return p},kt:function(){return m}});var t=r(7294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,s=function(e,n){if(null==e)return{};var r,t,s={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var l=t.createContext({}),c=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},p=function(e){var n=c(e.components);return t.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var r=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(r),m=s,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return r?t.createElement(g,a(a({ref:n},p),{},{components:r})):t.createElement(g,a({ref:n},p))}));function m(e,n){var r=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var o=r.length,a=new Array(o);a[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,a[1]=i;for(var c=2;c<o;c++)a[c]=r[c];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3673:function(e,n,r){"use strict";r.r(n),r.d(n,{frontMatter:function(){return a},metadata:function(){return i},toc:function(){return l},default:function(){return p}});var t=r(4034),s=r(9973),o=(r(7294),r(3905)),a={id:"upgrade",title:"Upgrade",sidebar_label:"Upgrade"},i={unversionedId:"installation/upgrade",id:"installation/upgrade",isDocsHomePage:!1,title:"Upgrade",description:"Following the steps in this document you can upgrade the system version.",source:"@site/docs/installation/upgrade.md",sourceDirName:"installation",slug:"/installation/upgrade",permalink:"/installation/upgrade",editUrl:"https://github.com/erxes/erxes/edit/develop/docs/docs/installation/upgrade.md",version:"current",lastUpdatedBy:"M. Munkhsaihan",lastUpdatedAt:1621341581,formattedLastUpdatedAt:"5/18/2021",sidebar_label:"Upgrade",frontMatter:{id:"upgrade",title:"Upgrade",sidebar_label:"Upgrade"},sidebar:"docs",previous:{title:"Docker",permalink:"/installation/docker"},next:{title:"Contributing guide",permalink:"/getting-started/contributing-guide"}},l=[{value:"Upgrade erxes 0.13.0 to 0.14.1",id:"upgrade-erxes-0130-to-0141",children:[]}],c={toc:l};function p(e){var n=e.components,r=(0,s.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,t.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Following the steps in this document you can upgrade the system version."),(0,o.kt)("h2",{id:"upgrade-erxes-0130-to-0141"},"Upgrade erxes 0.13.0 to 0.14.1"),(0,o.kt)("p",null,"They can be used to upgrade erxes v0.13.0 to v 0.14.1 if you are hosting erxes on Ubuntu."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"SSH into your server as ",(0,o.kt)("inlineCode",{parentName:"p"},"erxes"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"First, stop all pm2 processes and delete pm2 apps."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"pm2 stop ecosystem.json\npm2 delete ecosystem.json\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Move erxes, erxes-api, erxes-integrations and ecosystem.json somewhere as a backup. Also backup nginx config file in /etc/nginx/sites-available/default and dump your mongodb.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Then run the installation script as ",(0,o.kt)("inlineCode",{parentName:"p"},"root")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# If erxes hosted on Ubuntu\nbash -c "$(wget -O - https://github.com/erxes/erxes/blob/develop/scripts/install/ubuntu18.sh)"\n5. Afther the installation complete, run the following commands as `erxes` user\n\n')),(0,o.kt)("p",null,"cd ~/erxes-api\nexport MONGO_URL=mongodb://localhost/erxes?replicaSet=rs0\nyarn migrate"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\n6. Lastly, update `/home/erxes/erxes/ui/build/js/env.js`, `ecosystem.json` and start pm2 by `pm2 start ecosystem.json`, and update nginx config using your backup and reload nginx by `systemctl reload nginx`.\n\n   Note: We have noticed that `pm2 reload ecosystem.json` and `pm2 restart ecosystem.json` sometimes not picking up any changes to the `ecosystem.json` for some reason. So if you need to update `ecosystem.json` file, please use `pm2 delete ecosystem.json` and `pm2 start ecosystem.json` in the feature.\n\n## Upgrade erxes 0.15.x to 0.18.2\n\n1. login to your server\n2. ```cd /home/erxes && su erxes``` ( switch to erxes user)\n3. ```pm2 delete all```\n4. ```cp erxes/ui/build/js/env.js env.js.back``` (backup env.js file)\n5. ```rm -rf erxes && rm -rf erxes-api && rm -rf erxes-integrations``` (remove old files)\n6. Download new files\n    1. ```curl -L https://github.com/erxes/erxes/releases/download/0.18.2/erxes-0.18.2.tar.gz   | tar -xz -C .```\n    2. ```curl -L https://github.com/erxes/erxes-api/releases/download/0.18.2/erxes-api-0.18.2.tar.gz   | tar -xz -C .```\n    3. ```curl -L https://github.com/erxes/erxes-integrations/releases/download/0.18.2/erxes-integrations-0.18.2.tar.gz   | tar -xz -C .```\n\n7. ```mv env.js.back erxes/build/js/env.js``` (replace env)\n8. update ecosystem.json file\n    1. replace ```/home/erxes/erxes-api/engages-email-sender``` with ```/home/erxes/erxes-engages-email-sender```\n    2. replace ```/home/erxes/erxes-api/logger``` with ```/home/erxes/erxes-logger```\n    3. replace ```/home/erxes/erxes/widgets``` with ```/home/erxes/erxes-widgets```\n9. ```pm2 start ecosystem.json```\n10. ```exit``` ( switch to root user )\n11. ```vim /etc/nginx/sites-enabled/default``` (edit nginx config)\n12. replace ```/home/erxes/erxes/ui/build with ```/home/erxes/erxes/build```\n13. ```service nginx restart```\n\n## Upgrade erxes 0.17.x to 0.18.2\n\n1. login to your server\n2. ```cd /home/erxes/erxes.io && su erxes``` ( switch to erxes user)\n3. ```pm2 delete all```\n4. ```cp erxes/js/env.js env.js.back``` (backup env.js file)\n5. ```rm -rf erxes && rm -rf erxes-widgets && rm -rf erxes-api && rm -rf erxes-logger && rm -rf erxes-elkSyncer && rm -rf erxes-email-verifier && rm -rf erxes-engages-email-sender && rm -rf erxes-integrations``` (remove old files)\n6. Download new files\n    1. ```curl -L https://github.com/erxes/erxes/releases/download/0.18.2/erxes-0.18.2.tar.gz   | tar -xz -C .```\n    2. ```curl -L https://github.com/erxes/erxes-api/releases/download/0.18.2/erxes-api-0.18.2.tar.gz   | tar -xz -C .```\n    3. ```curl -L https://github.com/erxes/erxes-integrations/releases/download/0.18.2/erxes-integrations-0.18.2.tar.gz   | tar -xz -C .```\n7. ```mv env.js.back erxes/build/js/env.js``` (replace env)\n8. update ecosystem.json file\n    1. replace ```/home/erxes/erxes.io/erxes-elkSyncer``` with ```/home/erxes/erxes.io/erxes-elkSyncer/elkSyncer```\n9. ```pm2 start ecosystem.json```\n10. ```exit``` ( switch to root user )\n11. ```vim /etc/nginx/sites-enabled/default``` (edit nginx config)\n12. replace ```/home/erxes/erxes.io/erxes``` with ```/home/erxes/erxes.io/erxes/build```\n13. ```service nginx restart```\n\n## Upgrade erxes 0.19.2 to latest (0.20.x)\n\n1. Login as erxes user\n\n2. ```cd /home/erxes/erxes.io```\n\n3. Remove old folders\n```rm -rf erxes*```\n\n4. stop pm2 process\n ```pm2 delete all```\n\n5. Create erxes project\n```yarn create erxes-app erxes```\n\n6. Update MONGO_URL config\n- vim (nano) ecosystem.config.js (open ecosystem.config.js file)\n- copy MONGO_URL config from line 14\n- vim (nano) ../erxes.io/erxes/configs.json (open config.json file in erxes folder)\n- replace MONGO_URL config in line 3 with the copied value\n\n7. Run start command\n- ```cd erxes```\n- ```yarn start```\n- Enter your domain answer to the questions\n\n8. Switch to su and replace nginx config\n- ```exit```\n- ```cp erxes/nginx.conf /etc/nginx/sites-available/default```\n\n9. Run certbot again and restart nginx\n- ```sudo certbot --nginx```\n- ```service nginx restart```\n\n10. Done. Check your app in browser.\n\n\n\n## Upgrading from v0.9+ to the latest release vx.x.x\n\n### Breaking Changes\n\n- Since version `latest vx.x.x` Erxes started using RabbitMQ as message broker service. To update, please see example changes at docker [installation guide.](docker)\n- Engage module is moved to [separate repository](https://github.com/erxes/erxes-engages-email-sender). Also docker [installation guide](docker) is updated to reflect related changes.\n\n### Env changes\n\n- erxes\n\n  - `REACT_APP_INTEGRATIONS_API_URL` - is no longer used\n\n- erxes-api\n\n  - `ENGAGES_API_DOMAIN` - erxes-engages service endpoint\n  - `RABBITMQ_HOST` - RabbitMQ connection uri\n\n- erxes-widgets-api\n\n  - `RABBITMQ_HOST` - RabbitMQ connection uri\n\n- erxes-integrations\n\n  - `RABBITMQ_HOST` - RabbitMQ connection uri\n\n- erxes-engages\n  - `PORT` - engages service running port\n  - `NODE_ENV` - node environment\n  - `DEBUG` - enable logging\n  - `MAIN_API_DOMAIN` - erxes api url\n  - `MONGO_URL` - MongoDB connection uri\n  - `RABBITMQ_HOST` - RabbitMQ connection uri\n")))}p.isMDXComponent=!0}}]);